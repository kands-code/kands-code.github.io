<!DOCTYPE HTML>
<html
    lang="zh-Hans" 
    class="rust" 
    dir="ltr"> 
    <head>
        <title>Rust å­¦ä¹  14 - Kevin Stephen&#x27;s Blogs</title> 
        <meta charset="UTF-8">
        <meta name="description" content="æ‰¾åˆ°å±äºè‡ªå·±çš„å…‰">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        
         
        <link rel="icon" href="../../favicon.svg">
         
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <link rel="stylesheet"
            href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <link rel="stylesheet" href="../../theme/utils.css">

    </head>
    <body class="sidebar-visible no-js">
        <div id="body-container">
            <script>
                // è·å– root è·¯å¾„
                var path_to_root = "../../";
                // è·å–é»˜è®¤ä¸»é¢˜
                var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches
                    ? "ayu"
                    : "rust";
            </script>
            <script>
                try {
                    var theme = localStorage.getItem("mdbook-theme");
                    var sidebar = localStorage.getItem("mdbook-sidebar");

                    if (theme.startsWith('"') && theme.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-theme",
                            theme.slice(1, theme.length - 1).trim()
                        );
                    }

                    if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-sidebar",
                            sidebar.slice(1, sidebar.length - 1).trim()
                        );
                    }
                } catch (e) {}
            </script>
            <script>
                var theme;
                try {
                    theme = localStorage.getItem("mdbook-theme");
                } catch (e) {}
                if (theme === null || theme === undefined) {
                    theme = default_theme;
                }
                var html = document.querySelector("html");
                html.classList.remove("rust");
                html.classList.add(theme);
                var body = document.querySelector("body");
                body.classList.remove("no-js");
                body.classList.add("js");
            </script>

            <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">
            <script>
                var body = document.querySelector("body");
                var sidebar = null;
                var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
                if (document.body.clientWidth >= 1080) {
                try {
                    sidebar = localStorage.getItem("mdbook-sidebar");
                } catch (e) {}
                    sidebar = sidebar || "visible";
                } else {
                    sidebar = "hidden";
                }
                sidebar_toggle.checked = sidebar === "visible";
                body.classList.remove("sidebar-visible");
                body.classList.add("sidebar-" + sidebar);
            </script>

            <nav id="sidebar" class="sidebar" aria-label="Table of contents">
                <div class="sidebar-scrollbox">
                    <ol class="chapter"><li class="chapter-item "><a href="../../init.html">Init</a></li><li class="chapter-item affix "><li class="part-title">Notes</li><li class="chapter-item expanded "><a href="../../notes/rust/index.html">Rust</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/rust/20210605-rust-learn-01.html">Rust å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/rust/20210610-rust-learn-02.html">Rust å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/rust/20210824-rust-learn-03.html">Rust å­¦ä¹  03</a></li><li class="chapter-item "><a href="../../notes/rust/20211216-rust-learn-04.html">Rust å­¦ä¹  04</a></li><li class="chapter-item "><a href="../../notes/rust/20220512-rust-learn-05.html">Rust å­¦ä¹  05</a></li><li class="chapter-item "><a href="../../notes/rust/20220514-rust-learn-06.html">Rust å­¦ä¹  06</a></li><li class="chapter-item "><a href="../../notes/rust/20220520-rust-learn-07.html">Rust å­¦ä¹  07</a></li><li class="chapter-item "><a href="../../notes/rust/20220522-rust-learn-08.html">Rust å­¦ä¹  08</a></li><li class="chapter-item "><a href="../../notes/rust/20220523-rust-learn-09.html">Rust å­¦ä¹  09</a></li><li class="chapter-item "><a href="../../notes/rust/20220611-rust-learn-10.html">Rust å­¦ä¹  10</a></li><li class="chapter-item "><a href="../../notes/rust/20220619-rust-learn-11.html">Rust å­¦ä¹  11</a></li><li class="chapter-item "><a href="../../notes/rust/20220619-rust-learn-project-01.html">Rust å­¦ä¹  å®ä¾‹ 01</a></li><li class="chapter-item "><a href="../../notes/rust/20220623-rust-learn-12.html">Rust å­¦ä¹  12</a></li><li class="chapter-item "><a href="../../notes/rust/20220624-rust-learn-13.html">Rust å­¦ä¹  13</a></li><li class="chapter-item expanded "><a href="../../notes/rust/20220925-rust-learn-14.html" class="active">Rust å­¦ä¹  14</a></li><li class="chapter-item "><a href="../../notes/rust/20220925-rust-learn-15.html">Rust å­¦ä¹  15</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-final.html">Rust å­¦ä¹  final</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-project-02.html">Rust å­¦ä¹  å®ä¾‹ 02</a></li></ol></li><li class="chapter-item "><a href="../../notes/postgresql/index.html">PostgreSQL</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/postgresql/20230502-psql-learn-01.html">PostgreSQL å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231024-psql-learn-02.html">PostgreSQL å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231110-psql-learn-03.html">PostgreSQL å­¦ä¹  03</a></li></ol></li><li class="chapter-item "><a href="../../notes/typechallenges/index.html">Type Challenges</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/typechallenges/20230425-type-challenges-01.html">TypeScript ç±»å‹ä½“æ“ 01</a></li><li class="chapter-item "><a href="../../notes/typechallenges/20230428-type-challenges-02.html">TypeScript ç±»å‹ä½“æ“ 02</a></li></ol></li><li class="chapter-item "><li class="part-title">Miscellany</li><li class="chapter-item "><a href="../../miscellany/coding/index.html">Coding</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/coding/20210604-scope-of-if-statement.html">if è¯­å¥çš„ä½œç”¨åŸŸ</a></li><li class="chapter-item "><a href="../../miscellany/coding/20221026-parse-math-in-c.html">C è¯­è¨€æ•°å­¦è§£æå™¨</a></li><li class="chapter-item "><a href="../../miscellany/coding/20231107-clash-system-agent.html">Cğœ†ash ç³»ç»Ÿä»£ç†</a></li><li class="chapter-item "><a href="../../miscellany/coding/20240228-use-giscus-in-mdbook.html">åœ¨ mdBook ä¸­ä½¿ç”¨ giscus æœåŠ¡</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/study/index.html">Study</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/study/20221108-qiskit-linear-algebra.html">qiskit çº¿æ€§ä»£æ•°</a></li><li class="chapter-item "><a href="../../miscellany/study/20221111-qiskit-Deutsch-Jozsa-algorithm.html">qiskit Deutsch-Jozsa ç®—æ³•</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/life/index.html">Life</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/life/20230411-about-life.html">è¯´è¯´ä»¥åçš„æ‰“ç®—ç½¢</a></li><li class="chapter-item "><a href="../../miscellany/life/20230715-about-job.html">è°ˆè°ˆæœ€è¿‘çš„å·¥ä½œçŠ¶æ€</a></li><li class="chapter-item "><a href="../../miscellany/life/20230915-end-of-summer.html">æš‘å‡ç»“æŸäº†</a></li><li class="chapter-item "><a href="../../miscellany/life/20231020-new-life.html">æ–°çš„ç”Ÿæ´»</a></li><li class="chapter-item "><a href="../../miscellany/life/20240120-busy-life.html">å¿™å¿™ç¢Œç¢Œ</a></li><li class="spacer"></li></ol></li><li class="chapter-item "><a href="../../about.html">About</a></li></ol>
                </div>
                <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                    <div class="sidebar-resize-indicator"></div>
                </div>
            </nav>

            <script>
                var sidebarScrollbox = document.querySelector("#sidebar .sidebar-scrollbox");
                sidebarScrollbox.addEventListener(
                    "click",
                    function (e) {
                        if (e.target.tagName === "A") {
                            sessionStorage.setItem("sidebar-scroll", sidebarScrollbox.scrollTop);
                        }
                    },
                    { passive: true }
                );
                var sidebarScrollTop = sessionStorage.getItem("sidebar-scroll");
                sessionStorage.removeItem("sidebar-scroll");
                if (sidebarScrollTop) {
                    // preserve sidebar scroll position when navigating via links within sidebar
                    sidebarScrollbox.scrollTop = sidebarScrollTop;
                } else {
                    // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                    var activeSection = document.querySelector("#sidebar .active");
                    if (activeSection) {
                        activeSection.scrollIntoView({ block: "center" });
                    }
                }
            </script>

            <div id="page-wrapper" class="page-wrapper">
                <div class="page">
                                        <div id="menu-bar-hover-placeholder"></div>
                    <div id="menu-bar" class="menu-bar sticky">
                        <div class="left-buttons">
                            <label id="sidebar-toggle" class="icon-button"
                                for="sidebar-toggle-anchor"
                                title="Toggle Table of Contents"
                                aria-label="Toggle Table of Contents"
                                aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </label>
                            <button id="theme-toggle" class="icon-button"
                                type="button" title="Change theme"
                                aria-label="Change theme" aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup"
                                aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="light">Light</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            <button id="search-toggle" class="icon-button"
                                type="button" title="Search. (Shortkey: s)"
                                aria-label="Toggle Searchbar"
                                aria-expanded="false" aria-keyshortcuts="S"
                                aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                        <h1 class="menu-title">Kevin Stephen&#x27;s Blogs</h1>
                        <div class="right-buttons">
                            <a href="https://github.com/kands-code/kands-code.github.io"
                                title="Git repository"
                                aria-label="Git repository">
                                <i id="git-repository-button"
                                    class="fa fa-github"></i>
                            </a>
                            <a href="https://github.com/kands-code/kands-code.github.io/edit/repo-src/src/src/notes/rust/20220925-rust-learn-14.md"
                                title="Suggest an edit"
                                aria-label="Suggest an edit">
                                <i id="git-edit-button" class="fa fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    <div id="search-wrapper" class="hidden">
                        <form id="searchbar-outer" class="searchbar-outer">
                            <input type="search" id="searchbar" name="searchbar"
                                placeholder="searching..."
                                aria-controls="searchresults-outer"
                                aria-describedby="searchresults-header">
                        </form>
                        <div id="searchresults-outer"
                            class="searchresults-outer hidden">
                            <div id="searchresults-header"
                                class="searchresults-header"></div>
                            <ul id="searchresults">
                            </ul>
                        </div>
                    </div>
                    <script>
                        document
                            .getElementById("sidebar-toggle")
                            .setAttribute("aria-expanded", sidebar === "visible");
                        document
                            .getElementById("sidebar")
                            .setAttribute("aria-hidden", sidebar !== "visible");
                        Array.from(document.querySelectorAll("#sidebar a")).forEach(function (link) {
                            link.setAttribute("tabIndex", sidebar === "visible" ? 0 : -1);
                        });
                    </script>

                    <div id="content" class="content">
                        <main><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="rust-å­¦ä¹ -14"><a class="header" href="#rust-å­¦ä¹ -14">Rust å­¦ä¹  14</a></h1>
<p class="archive-time">archive time: 2022-09-25</p>
<p class="sp-comment">ä»Šå¤©å¼€å§‹å­¦å¹¶å‘çš„å†…å®¹äº†</p>
<ul>
<li><a href="#%E5%B9%B6%E5%8F%91">å¹¶å‘</a></li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B">è¿›ç¨‹å’Œçº¿ç¨‹</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B">ä½¿ç”¨çº¿ç¨‹</a>
<ul>
<li><a href="#%E7%BA%BF%E7%A8%8B%E9%97%B4%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83">çº¿ç¨‹é—´çš„æ‰€æœ‰æƒ</a></li>
</ul>
</li>
</ul>
<p>Rust çš„å®‰å…¨æ€§åœ¨å¹¶å‘ä¸­ä¹Ÿæœ‰ä½“ç°</p>
<h2 id="å¹¶å‘"><a class="header" href="#å¹¶å‘">å¹¶å‘</a></h2>
<p>å¹¶å‘ (concurrent)ï¼ŒæŒ‡ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´ <strong>ç‹¬ç«‹</strong> è¿è¡Œï¼Œè¿™ä¸ªå’Œ å¹¶è¡Œ (parallel) æ˜¯æœ‰åŒºåˆ«çš„</p>
<p>å¹¶å‘å¼ºè°ƒçš„æ˜¯ä¸åŒéƒ¨åˆ†å¯ä»¥ <em>ç‹¬ç«‹</em> è¿è¡Œï¼Œè€Œå¹¶è¡Œåˆ™å¼ºè°ƒä¸åŒéƒ¨åˆ† <em>åŒæ—¶</em> è¿è¡Œ</p>
<h2 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a class="header" href="#è¿›ç¨‹å’Œçº¿ç¨‹">è¿›ç¨‹å’Œçº¿ç¨‹</a></h2>
<p>å¤§éƒ¨åˆ† OS é‡Œï¼Œä»£ç è¿è¡Œåœ¨ <strong>è¿›ç¨‹ (process)</strong> é‡Œï¼ŒOS ç®¡ç†å¤šä¸ªè¿›ç¨‹</p>
<p>ç¨‹åºé‡Œï¼Œå„ä¸ªéƒ¨åˆ†ç‹¬ç«‹è¿è¡Œï¼Œè¿è¡Œè¿™äº›ç‹¬ç«‹éƒ¨åˆ†çš„å°±æ˜¯ <strong>çº¿ç¨‹ (thread)</strong></p>
<p>å¤šçº¿ç¨‹è¿è¡Œç‰¹ç‚¹:</p>
<ul>
<li>æå‡æ€§èƒ½è¡¨ç°</li>
<li>å¢åŠ å¤æ‚æ€§ï¼Œæ— æ³•ä¿è¯å„ä¸ªçº¿ç¨‹æ‰§è¡Œé¡ºåº</li>
</ul>
<p>å¯èƒ½å½±å“çš„é—®é¢˜:</p>
<ul>
<li>ç«äº‰çŠ¶æ€ï¼Œçº¿ç¨‹ä»¥ä¸ä¸€è‡´çš„é¡ºåºè®¿é—®æ•°æ®æˆ–èµ„æº</li>
<li>æ­»é”<sup class="footnote-reference"><a href="#1">1</a></sup>ï¼Œä¸¤ä¸ªçº¿ç¨‹å½¼æ­¤ç­‰å¾…å¯¹æ–¹ä½¿ç”¨å®Œæ‰€æŒæœ‰çš„èµ„æºï¼Œçº¿ç¨‹æ— æ³•ç»§ç»­</li>
<li>å®¹æ˜“æœ‰ä¸€äº› <em>ç¥å¿…</em> bugï¼Œéš¾ä»¥å¤ç°æˆ–ä¿®å¤</li>
</ul>
<p>ä¸€èˆ¬çº¿ç¨‹çš„å®ç°æ–¹å¼:</p>
<ul>
<li>è°ƒç”¨ç³»ç»Ÿ API æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹å¯¹åº”ä¸€ä¸ªè¯­è¨€çº¿ç¨‹</li>
<li>è¯­è¨€è‡ªå·±å®ç°çº¿ç¨‹ï¼ŒM ä¸ªç»¿è‰²çº¿ç¨‹<sup class="footnote-reference"><a href="#2">2</a></sup> å¯¹åº” N ä¸ªç³»ç»Ÿçº¿ç¨‹</li>
</ul>
<p>Rust æ ‡å‡†åº“ä»…æä¾› 1:1 æ¨¡å‹</p>
<h2 id="ä½¿ç”¨çº¿ç¨‹"><a class="header" href="#ä½¿ç”¨çº¿ç¨‹">ä½¿ç”¨çº¿ç¨‹</a></h2>
<p>åœ¨ Rust ä¸­ä½¿ç”¨ <code>std::thread</code> æ¥ä½¿ç”¨çº¿ç¨‹ï¼Œ<code>thread::spawn()</code> æ¥ç”Ÿæˆçº¿ç¨‹</p>
<p><code>spawn()</code> å‡½æ•°æ¥å—ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºè¦åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»£ç </p>
<pre><code class="language-rust">use std::{thread, time::Duration};

fn main() {
    thread::spawn(|| {
        for i in 1..=10 {
            println!("hi number {} from the spawned thread!", i);
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in 1..=5 {
        println!("hi number {} from the main thread!", i);
        thread::sleep(Duration::from_millis(1));
    }
}</code></pre>
<p>å¯¹åº”è¾“å‡º</p>
<pre><code class="language-text">hi number 1 from the main thread!
hi number 1 from the spawned thread!
hi number 2 from the main thread!
hi number 2 from the spawned thread!
hi number 3 from the spawned thread!
hi number 3 from the main thread!
hi number 4 from the spawned thread!
hi number 4 from the main thread!
hi number 5 from the spawned thread!
hi number 5 from the main thread!
hi number 6 from the spawned thread!
</code></pre>
<p>æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ç”Ÿæˆçš„çº¿ç¨‹åœ¨ä¸»çº¿ç¨‹è¿è¡Œç»“æŸåï¼Œå³ä¾¿è¿˜æœªè¿è¡Œå®Œæ¯•ï¼Œä¾æ—§è¢«ç»“æŸäº†</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œé‚£å°±æ˜¯ <em>join handle</em></p>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>spawn()</code> å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª <code>JoinHandle&lt;T&gt;</code> ç±»å‹ï¼Œ
æˆ‘ä»¬è°ƒç”¨å…¶æ–¹æ³• <code>join()</code> å¯ä»¥é˜»æ­¢å½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°å¯¹åº” handle æ‰§è¡Œç»“æŸ</p>
<p><code>join()</code> æ–¹æ³•è¿”å›çš„æ˜¯ <code>Result&lt;T&gt;</code> ç±»å‹ï¼Œéœ€è¦å¤„ç†ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ <code>unwrap()</code> è·³è¿‡</p>
<pre><code class="language-rust">use std::{thread, time::Duration};

fn main() {
    thread::spawn(|| {
        for i in 1..=10 {
            println!("hi number {} from the spawned thread!", i);
            thread::sleep(Duration::from_millis(1));
        }
    })
    .join()
    .unwrap();

    for i in 1..=5 {
        println!("hi number {} from the main thread!", i);
        thread::sleep(Duration::from_millis(1));
    }
}</code></pre>
<p>æ­¤æ—¶çš„æ‰§è¡Œç»“æœæ˜¯</p>
<pre><code class="language-text">hi number 1 from the spawned thread!
hi number 2 from the spawned thread!
hi number 3 from the spawned thread!
hi number 4 from the spawned thread!
hi number 5 from the spawned thread!
hi number 6 from the spawned thread!
hi number 7 from the spawned thread!
hi number 8 from the spawned thread!
hi number 9 from the spawned thread!
hi number 10 from the spawned thread!
hi number 1 from the main thread!
hi number 2 from the main thread!
hi number 3 from the main thread!
hi number 4 from the main thread!
hi number 5 from the main thread!
</code></pre>
<p>å³ï¼Œå…ˆæ‰§è¡Œå®Œæˆ‘ä»¬çš„å­çº¿ç¨‹ï¼Œå†æ‰§è¡Œä¸»çº¿ç¨‹</p>
<p>ä½†æ˜¯ï¼Œæ›´å¥½çš„åšæ³•æ˜¯</p>
<pre><code class="language-rust">use std::{thread, time::Duration};

fn main() {
    let handle = thread::spawn(|| {
        for i in 1..=10 {
            println!("hi number {} from the spawned thread!", i);
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in 1..=5 {
        println!("hi number {} from the main thread!", i);
        thread::sleep(Duration::from_millis(1));
    }

    handle.join().unwrap();
}</code></pre>
<p>è¿™æ ·ï¼Œä¸€å¼€å§‹ï¼Œä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹æ˜¯äº¤æ›¿çš„ï¼Œç„¶åå­çº¿ç¨‹é˜»å¡ä¸»çº¿ç¨‹ï¼Œä¸è®©ä¸»çº¿ç¨‹ç»“æŸï¼Œç›´åˆ°å­çº¿ç¨‹å®Œæˆ</p>
<pre><code class="language-text">hi number 1 from the main thread!
hi number 1 from the spawned thread!
hi number 2 from the main thread!
hi number 2 from the spawned thread!
hi number 3 from the main thread!
hi number 3 from the spawned thread!
hi number 4 from the main thread!
hi number 4 from the spawned thread!
hi number 5 from the main thread!
hi number 5 from the spawned thread!
hi number 6 from the spawned thread!
hi number 7 from the spawned thread!
hi number 8 from the spawned thread!
hi number 9 from the spawned thread!
hi number 10 from the spawned thread!
</code></pre>
<h3 id="çº¿ç¨‹é—´çš„æ‰€æœ‰æƒ"><a class="header" href="#çº¿ç¨‹é—´çš„æ‰€æœ‰æƒ">çº¿ç¨‹é—´çš„æ‰€æœ‰æƒ</a></h3>
<p>è¦ä½¿ç”¨å…¶ä»–çº¿ç¨‹çš„å˜é‡æˆ–è€…å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>move</code> å°†æ‰€æœ‰æƒç§»äº¤è‡³å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ <strong>move é—­åŒ…</strong></p>
<pre><code class="language-rust">use rand::Rng;
use std::thread;
use std::time::Duration;

fn main() {
    let mut rng = rand::thread_rng();
    let v = rng.gen::&lt;[u8; 5]&gt;();

    println!("{:?}", v);

    let handle = thread::spawn(move || {
        for i in v {
            println!("hi number {} from the spawned thread!", i);
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in v {
        println!("hi number {} from the main thread!", i);
        thread::sleep(Duration::from_millis(1));
    }

    handle.join().unwrap();
}</code></pre>
<p>å¯¹åº”è¾“å‡ºæ˜¯</p>
<pre><code class="language-text">[33, 108, 92, 80, 1]
hi number 33 from the main thread!
hi number 33 from the spawned thread!
hi number 108 from the main thread!
hi number 108 from the spawned thread!
hi number 92 from the main thread!
hi number 92 from the spawned thread!
hi number 80 from the main thread!
hi number 80 from the spawned thread!
hi number 1 from the main thread!
hi number 1 from the spawned thread!
</code></pre>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ move çš„æ–¹å¼ä½¿å¾—å­çº¿ç¨‹å¯ä»¥ä½¿ç”¨ä¸»çº¿ç¨‹çš„å˜é‡ v</p>
<hr />
<p>å¥½ï¼Œä»Šå¤©å°±å­¦åˆ°è¿™é‡Œäº†ï¼Œæ˜å¤©å­¦ä¹ æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œæ‘¸äº†</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Wikipedia.Deadlock [DB/OL].
<a href="https://en.wikipedia.org/wiki/Deadlock">https://en.wikipedia.org/wiki/Deadlock</a>,
2022-08-25/2022-09-25</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>Wikipedia.Green_thread [DB/OL].
<a href="https://en.wikipedia.org/wiki/Green_thread">https://en.wikipedia.org/wiki/Green_thread</a>,
2022-08-20/2022-09-25</p>
</div>
</main>
                        <nav class="nav-wrapper" aria-label="Page navigation">
                            <a rel="prev" href="../../notes/rust/20220624-rust-learn-13.html"
                                class="mobile-nav-chapters previous"
                                title="Previous chapter"
                                aria-label="Previous chapter"
                                aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next prefetch"
                                href="../../notes/rust/20220925-rust-learn-15.html"
                                class="mobile-nav-chapters next"
                                title="Next chapter" aria-label="Next chapter"
                                aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                            <div style="clear: both"></div>
                        </nav>
                    </div>
                </div>
                <div class="giscus-comment">
                </div>
                <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../notes/rust/20220624-rust-learn-13.html"
                        class="nav-chapters previous" title="Previous chapter"
                        aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next prefetch" href="../../notes/rust/20220925-rust-learn-15.html"
                        class="nav-chapters next" title="Next chapter"
                        aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                </nav>
            </div>
            <script>
                window.playground_copyable = true;
            </script>
            <script src="../../elasticlunr.min.js"></script>
            <script src="../../mark.min.js"></script>
            <script src="../../searcher.js"></script>
            <script src="../../clipboard.min.js"></script>
            <script src="../../highlight.js"></script>
            <script src="../../book.js"></script>
            <script src="../../theme/giscus.js"></script>
        </div>
    </body>
</html>
