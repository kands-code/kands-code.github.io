<!DOCTYPE HTML>
<html
    lang="zh-Hans" 
    class="rust" 
    dir="ltr"> 
    <head>
        <title>Rust å­¦ä¹  10 - Kevin Stephen&#x27;s Blogs</title> 
        <meta charset="UTF-8">
        <meta name="description" content="æ‰¾åˆ°å±äºè‡ªå·±çš„å…‰">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        
         
        <link rel="icon" href="../../favicon.svg">
         
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <link rel="stylesheet"
            href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <link rel="stylesheet" href="../../theme/utils.css">

    </head>
    <body class="sidebar-visible no-js">
        <div id="body-container">
            <script>
                // è·å– root è·¯å¾„
                var path_to_root = "../../";
                // è·å–é»˜è®¤ä¸»é¢˜
                var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches
                    ? "ayu"
                    : "rust";
            </script>
            <script>
                try {
                    var theme = localStorage.getItem("mdbook-theme");
                    var sidebar = localStorage.getItem("mdbook-sidebar");

                    if (theme.startsWith('"') && theme.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-theme",
                            theme.slice(1, theme.length - 1).trim()
                        );
                    }

                    if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-sidebar",
                            sidebar.slice(1, sidebar.length - 1).trim()
                        );
                    }
                } catch (e) {}
            </script>
            <script>
                var theme;
                try {
                    theme = localStorage.getItem("mdbook-theme");
                } catch (e) {}
                if (theme === null || theme === undefined) {
                    theme = default_theme;
                }
                var html = document.querySelector("html");
                html.classList.remove("rust");
                html.classList.add(theme);
                var body = document.querySelector("body");
                body.classList.remove("no-js");
                body.classList.add("js");
            </script>

            <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">
            <script>
                var body = document.querySelector("body");
                var sidebar = null;
                var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
                if (document.body.clientWidth >= 1080) {
                try {
                    sidebar = localStorage.getItem("mdbook-sidebar");
                } catch (e) {}
                    sidebar = sidebar || "visible";
                } else {
                    sidebar = "hidden";
                }
                sidebar_toggle.checked = sidebar === "visible";
                body.classList.remove("sidebar-visible");
                body.classList.add("sidebar-" + sidebar);
            </script>

            <nav id="sidebar" class="sidebar" aria-label="Table of contents">
                <div class="sidebar-scrollbox">
                    <ol class="chapter"><li class="chapter-item "><a href="../../init.html">Init</a></li><li class="chapter-item "><a href="../../about.html">About</a></li><li class="chapter-item affix "><li class="part-title">Notes</li><li class="chapter-item expanded "><a href="../../notes/rust/index.html">Rust</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/rust/20210605-rust-learn-01.html">Rust å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/rust/20210610-rust-learn-02.html">Rust å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/rust/20210824-rust-learn-03.html">Rust å­¦ä¹  03</a></li><li class="chapter-item "><a href="../../notes/rust/20211216-rust-learn-04.html">Rust å­¦ä¹  04</a></li><li class="chapter-item "><a href="../../notes/rust/20220512-rust-learn-05.html">Rust å­¦ä¹  05</a></li><li class="chapter-item "><a href="../../notes/rust/20220514-rust-learn-06.html">Rust å­¦ä¹  06</a></li><li class="chapter-item "><a href="../../notes/rust/20220520-rust-learn-07.html">Rust å­¦ä¹  07</a></li><li class="chapter-item "><a href="../../notes/rust/20220522-rust-learn-08.html">Rust å­¦ä¹  08</a></li><li class="chapter-item "><a href="../../notes/rust/20220523-rust-learn-09.html">Rust å­¦ä¹  09</a></li><li class="chapter-item expanded "><a href="../../notes/rust/20220611-rust-learn-10.html" class="active">Rust å­¦ä¹  10</a></li><li class="chapter-item "><a href="../../notes/rust/20220619-rust-learn-11.html">Rust å­¦ä¹  11</a></li><li class="chapter-item "><a href="../../notes/rust/20220619-rust-learn-project-01.html">Rust å­¦ä¹  å®ä¾‹ 01</a></li><li class="chapter-item "><a href="../../notes/rust/20220623-rust-learn-12.html">Rust å­¦ä¹  12</a></li><li class="chapter-item "><a href="../../notes/rust/20220624-rust-learn-13.html">Rust å­¦ä¹  13</a></li><li class="chapter-item "><a href="../../notes/rust/20220925-rust-learn-14.html">Rust å­¦ä¹  14</a></li><li class="chapter-item "><a href="../../notes/rust/20220925-rust-learn-15.html">Rust å­¦ä¹  15</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-final.html">Rust å­¦ä¹  final</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-project-02.html">Rust å­¦ä¹  å®ä¾‹ 02</a></li></ol></li><li class="chapter-item "><a href="../../notes/postgresql/index.html">PostgreSQL</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/postgresql/20230502-psql-learn-01.html">PostgreSQL å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231024-psql-learn-02.html">PostgreSQL å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231110-psql-learn-03.html">PostgreSQL å­¦ä¹  03</a></li></ol></li><li class="chapter-item "><a href="../../notes/typechallenges/index.html">Type Challenges</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/typechallenges/20230425-type-challenges-01.html">TypeScript ç±»å‹ä½“æ“ 01</a></li><li class="chapter-item "><a href="../../notes/typechallenges/20230428-type-challenges-02.html">TypeScript ç±»å‹ä½“æ“ 02</a></li></ol></li><li class="chapter-item "><li class="part-title">Miscellany</li><li class="chapter-item "><a href="../../miscellany/coding/index.html">Coding</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/coding/20210604-scope-of-if-statement.html">if è¯­å¥çš„ä½œç”¨åŸŸ</a></li><li class="chapter-item "><a href="../../miscellany/coding/20221026-parse-math-in-c.html">C è¯­è¨€æ•°å­¦è§£æå™¨</a></li><li class="chapter-item "><a href="../../miscellany/coding/20231107-clash-system-agent.html">Cğœ†ash ç³»ç»Ÿä»£ç†</a></li><li class="chapter-item "><a href="../../miscellany/coding/20240228-use-giscus-in-mdbook.html">åœ¨ mdBook ä¸­ä½¿ç”¨ giscus æœåŠ¡</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/study/index.html">Study</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/study/20221108-qiskit-linear-algebra.html">qiskit çº¿æ€§ä»£æ•°</a></li><li class="chapter-item "><a href="../../miscellany/study/20221111-qiskit-Deutsch-Jozsa-algorithm.html">qiskit Deutsch-Jozsa ç®—æ³•</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/life/index.html">Life</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/life/20230411-about-life.html">è¯´è¯´ä»¥åçš„æ‰“ç®—ç½¢</a></li><li class="chapter-item "><a href="../../miscellany/life/20230715-about-job.html">è°ˆè°ˆæœ€è¿‘çš„å·¥ä½œçŠ¶æ€</a></li><li class="chapter-item "><a href="../../miscellany/life/20230915-end-of-summer.html">æš‘å‡ç»“æŸäº†</a></li><li class="chapter-item "><a href="../../miscellany/life/20231020-new-life.html">æ–°çš„ç”Ÿæ´»</a></li><li class="chapter-item "><a href="../../miscellany/life/20240120-busy-life.html">å¿™å¿™ç¢Œç¢Œ</a></li></ol></li></ol>
                </div>
                <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                    <div class="sidebar-resize-indicator"></div>
                </div>
            </nav>

            <script>
                var sidebarScrollbox = document.querySelector("#sidebar .sidebar-scrollbox");
                sidebarScrollbox.addEventListener(
                    "click",
                    function (e) {
                        if (e.target.tagName === "A") {
                            sessionStorage.setItem("sidebar-scroll", sidebarScrollbox.scrollTop);
                        }
                    },
                    { passive: true }
                );
                var sidebarScrollTop = sessionStorage.getItem("sidebar-scroll");
                sessionStorage.removeItem("sidebar-scroll");
                if (sidebarScrollTop) {
                    // preserve sidebar scroll position when navigating via links within sidebar
                    sidebarScrollbox.scrollTop = sidebarScrollTop;
                } else {
                    // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                    var activeSection = document.querySelector("#sidebar .active");
                    if (activeSection) {
                        activeSection.scrollIntoView({ block: "center" });
                    }
                }
            </script>

            <div id="page-wrapper" class="page-wrapper">
                <div class="page">
                                        <div id="menu-bar-hover-placeholder"></div>
                    <div id="menu-bar" class="menu-bar sticky">
                        <div class="left-buttons">
                            <label id="sidebar-toggle" class="icon-button"
                                for="sidebar-toggle-anchor"
                                title="Toggle Table of Contents"
                                aria-label="Toggle Table of Contents"
                                aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </label>
                            <button id="theme-toggle" class="icon-button"
                                type="button" title="Change theme"
                                aria-label="Change theme" aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup"
                                aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="light">Light</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            <button id="search-toggle" class="icon-button"
                                type="button" title="Search. (Shortkey: s)"
                                aria-label="Toggle Searchbar"
                                aria-expanded="false" aria-keyshortcuts="S"
                                aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                        <h1 class="menu-title">Kevin Stephen&#x27;s Blogs</h1>
                        <div class="right-buttons">
                            <a href="https://github.com/kands-code/kands-code.github.io"
                                title="Git repository"
                                aria-label="Git repository">
                                <i id="git-repository-button"
                                    class="fa fa-github"></i>
                            </a>
                            <a href="https://github.com/kands-code/kands-code.github.io/edit/repo-src/src/src/notes/rust/20220611-rust-learn-10.md"
                                title="Suggest an edit"
                                aria-label="Suggest an edit">
                                <i id="git-edit-button" class="fa fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    <div id="search-wrapper" class="hidden">
                        <form id="searchbar-outer" class="searchbar-outer">
                            <input type="search" id="searchbar" name="searchbar"
                                placeholder="searching..."
                                aria-controls="searchresults-outer"
                                aria-describedby="searchresults-header">
                        </form>
                        <div id="searchresults-outer"
                            class="searchresults-outer hidden">
                            <div id="searchresults-header"
                                class="searchresults-header"></div>
                            <ul id="searchresults">
                            </ul>
                        </div>
                    </div>
                    <script>
                        document
                            .getElementById("sidebar-toggle")
                            .setAttribute("aria-expanded", sidebar === "visible");
                        document
                            .getElementById("sidebar")
                            .setAttribute("aria-hidden", sidebar !== "visible");
                        Array.from(document.querySelectorAll("#sidebar a")).forEach(function (link) {
                            link.setAttribute("tabIndex", sidebar === "visible" ? 0 : -1);
                        });
                    </script>

                    <div id="content" class="content">
                        <main><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="rust-å­¦ä¹ -10"><a class="header" href="#rust-å­¦ä¹ -10">Rust å­¦ä¹  10</a></h1>
<p class="archive-time">archive time: 2022-06-11</p>
<p class="sp-comment">è¿™å›æ¥å­¦ä¸€ä¸‹ç”Ÿå‘½å‘¨æœŸ</p>
<ul>
<li><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">ç”Ÿå‘½å‘¨æœŸ</a>
<ul>
<li><a href="#example">example</a></li>
<li><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%A0%87%E6%B3%A8">ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨</a></li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">ç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸ</a></li>
<li><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E8%A7%84%E5%88%99">ç”Ÿå‘½å‘¨æœŸè§„åˆ™</a></li>
<li><a href="#%E9%9D%99%E6%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">é™æ€ç”Ÿå‘½å‘¨æœŸ</a></li>
</ul>
</li>
<li><a href="#%E6%B5%8B%E8%AF%95">æµ‹è¯•</a>
<ul>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E6%B6%88%E6%81%AF">è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯</a></li>
<li><a href="#should_panic">should_panic</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E9%87%8C%E7%9A%84-result">æµ‹è¯•é‡Œçš„ <code>Result</code></a></li>
<li><a href="#cargo-test"><code>cargo test</code></a>
<ul>
<li><a href="#%E6%B5%8B%E8%AF%95%E7%BA%BF%E7%A8%8B%E6%95%B0">æµ‹è¯•çº¿ç¨‹æ•°</a></li>
<li><a href="#%E6%98%BE%E7%A4%BA%E8%BE%93%E5%87%BA">æ˜¾ç¤ºè¾“å‡º</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E6%8C%87%E5%AE%9A%E6%B5%8B%E8%AF%95">æ‰§è¡ŒæŒ‡å®šæµ‹è¯•</a></li>
<li><a href="#%E5%BF%BD%E7%95%A5%E6%B5%8B%E8%AF%95">å¿½ç•¥æµ‹è¯•</a></li>
</ul>
</li>
<li><a href="#%E6%B5%8B%E8%AF%95%E7%BB%84%E7%BB%87">æµ‹è¯•ç»„ç»‡</a>
<ul>
<li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">å•å…ƒæµ‹è¯•</a></li>
<li><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95">é›†æˆæµ‹è¯•</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ç”Ÿå‘½å‘¨æœŸ"><a class="header" href="#ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ</a></h2>
<p>Rust ä¸­, æ¯ä¸ª <strong><em>å¼•ç”¨</em></strong> éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ, æ˜¯ä¸ºäº†è®©å¼•ç”¨ä¿æŒæœ‰æ•ˆçš„ä½œç”¨åŸŸ</p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹, ç”Ÿå‘½å‘¨æœŸæ˜¯å¯ä»¥è¢«è‡ªåŠ¨æ¨å¯¼çš„, ä¸éœ€è¦æ‰‹åŠ¨æ ‡æ³¨</p>
<p>ä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹è¿˜æ˜¯éœ€è¦è‡ªå·±æ‰‹åŠ¨æ ‡æ³¨çš„, ä¾‹å¦‚ <code>'static</code></p>
<pre><code class="language-rust">pub fn derv&lt;'a, F&gt;(f: &amp;'a F) -&gt; Box&lt;dyn Fn(f64) -&gt; f64 + 'a&gt;
where
    F: Fn(f64) -&gt; f64 + 'a,
{
    let dx = 1e-6;
    Box::new(move |x: f64| -&gt; f64 { (f(x + dx) - f(x)) / dx })
}</code></pre>
<p>åœ¨ä¸Šé¢è¿™ä¸ªå‡½æ•°çš„ä¾‹å­é‡Œ, æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç»™æ³›å‹ Trait <code>F</code> åŠ ä¸Š <code>'a</code> è¿™æ ·ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçš„çº¦æŸ</p>
<p>åŠ ä¸Šç”Ÿå‘½å‘¨æœŸçš„çº¦æŸæ˜¯ä¸ºäº†æŒ‡æ˜è¿”å›å€¼å’Œå‚æ•°ä¹‹é—´çš„å…³ç³»</p>
<p>ç”Ÿå‘½å‘¨æœŸè¦è§£å†³çš„é—®é¢˜å°±æ˜¯åœ¨ <code>Cpp</code> ä¸­å¸¸è§çš„é”™è¯¯ <strong>æ‚¬å‚å¼•ç”¨ (<em>dangling reference</em>)</strong></p>
<pre><code class="language-rust">let r;
{
    let x = 6;
    r = &amp;x; // error here
}
println("{}", r);</code></pre>
<p>ä¸Šé¢è¿™ä¸ªä¾‹å­, ç”±äº <code>x</code> åœ¨ç¦»å¼€ä½œç”¨åŸŸåå°±è¢« <em>drop</em> æ‰äº†, æ‰€ä»¥ <code>r</code> å°±å€Ÿç”¨äº†ä¸€ä¸ªæ— æ•ˆçš„å€¼,
è¿™æ˜¯é”™è¯¯çš„, è€Œ Rust ç¼–è¯‘å™¨å¯ä»¥æ£€æŸ¥å‡ºè¿™ç§é—®é¢˜</p>
<p>Rust ç¼–è¯‘å™¨ ä½¿ç”¨äº† <em>Borrow Checker</em> é€šè¿‡æ¯”è¾ƒä½œç”¨åŸŸæ¥åˆ¤æ–­æ‰€æœ‰çš„å€Ÿç”¨æ˜¯å¦åˆæ³•</p>
<h3 id="example"><a class="header" href="#example">example</a></h3>
<p>è¿™é‡Œçœ‹ä¸€ä¸ªå‡½æ•°çš„ä¾‹å­</p>
<pre><code class="language-rust">fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str {
    if x.len() &gt; y.len() {
        x
    } else {
        y
    }
}</code></pre>
<p>è¿™é‡Œç”±äº <code>x</code> å’Œ <code>y</code> è¿™ä¸¤ä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å¯èƒ½æœ‰åŒºåˆ«, æ‰€ä»¥éœ€è¦æ˜¾å¼æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ</p>
<p>è§£å†³æ–¹æ³•å°±æ˜¯æ ‡æ³¨ä¸Šç”Ÿå‘½å‘¨æœŸ</p>
<pre><code class="language-rust">fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str {
    if x.len() &gt; y.len() {
        x
    } else {
        y
    }
}</code></pre>
<h3 id="ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨"><a class="header" href="#ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨">ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨</a></h3>
<p>ç”Ÿå‘½å‘¨æœŸä»¥ <code>'</code> å¼€å¤´, è€Œä¸”æ˜¯å…¨å°å†™, æ ‡è¯†ç¬¦ä¸€èˆ¬æ¯”è¾ƒçŸ­, å¸¸è§å‘½åå°±æ˜¯ <code>'a</code></p>
<p>ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬æ”¾åœ¨å¼•ç”¨ç¬¦å·ä¹‹å</p>
<pre><code class="language-rust">&amp;i32 // ref
&amp;'a i32 // explict lifetime ref
&amp;'a mut i32 // mutable explict lifetime ref</code></pre>
<p>ä¸è¿‡å•ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨æ²¡æœ‰æ„ä¹‰, æ ‡æ³¨ä¸€èˆ¬ç”¨äºè¯´æ˜å¤šä¸ªå¼•ç”¨ä¹‹é—´çš„ç”Ÿå‘½å‘¨æœŸçš„ <em>å…³ç³»</em></p>
<pre><code class="language-rust">fn longest&lt;'a&gt;(x: &amp;'a str, y: &amp;'a str) -&gt; &amp;'a str</code></pre>
<p>è¿™é‡Œè¡¨æ˜ è¿”å›å€¼ å’Œ <code>x</code> ä»¥åŠ <code>y</code> çš„ç”Ÿå‘½å‘¨æœŸä¸çŸ­äº <code>'a</code>, å³ä¿è¯äº†è¿”å›çš„å¼•ç”¨çš„æœ‰æ•ˆæ€§</p>
<p>ä»å‡½æ•°è¿”å›å¼•ç”¨æ—¶, <em>è¿”å›å€¼</em> çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°éœ€è¦å’Œå…¶ä¸­ä¸€ä¸ªå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸ <strong>åŒ¹é…</strong></p>
<h3 id="ç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸ"><a class="header" href="#ç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸ">ç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸ</a></h3>
<p>åœ¨ <code>struct</code> é‡Œæœ‰ å¼•ç”¨æ•°æ®é¡¹ çš„æ—¶å€™, éœ€è¦åœ¨æ¯ä¸ªå¼•ç”¨ä¸Šæ·»åŠ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨</p>
<pre><code class="language-rust">struct Test&lt;'a&gt; {
    part: &amp;'a str,
}</code></pre>
<p>è¿™é‡Œæ˜¯ä¸ºäº†ä¿è¯åœ¨ç»“æ„ä½“å®ä¾‹æœ‰æ•ˆçš„æ—¶å€™, å†…éƒ¨çš„å¼•ç”¨ä¹Ÿæ˜¯æœ‰æ•ˆçš„</p>
<h3 id="ç”Ÿå‘½å‘¨æœŸè§„åˆ™"><a class="header" href="#ç”Ÿå‘½å‘¨æœŸè§„åˆ™">ç”Ÿå‘½å‘¨æœŸè§„åˆ™</a></h3>
<p>ç¼–è¯‘å™¨æœ‰ 3 æ¡<sup class="footnote-reference"><a href="#1">1</a></sup>è§„åˆ™ç”¨äºæ¨å¯¼å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ</p>
<ol>
<li>æ¯ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°, é‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸå°±è¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°</li>
<li>å¦‚æœæœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°, ä½†å…¶ä¸­ä¸€ä¸ªæ˜¯ <code>&amp;self</code> æˆ–è€… <code>&amp;mut self</code>,
é‚£ä¹ˆ <code>self</code> çš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°</li>
</ol>
<pre><code class="language-rust">/// ex01
fn first_word(s: &amp;str) -&gt; &amp;str
// =&gt; rule 1
fn first_word&lt;'a&gt;(s: &amp;'a str) -&gt; &amp;str
// =&gt; rule 2
fn first_word&lt;'a&gt;(s: &amp;'a str) -&gt; &amp;'a str

/// ex02
fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str
// =&gt; rule 1
fn longest&lt;'a, 'b&gt;(x: &amp;'a str, y: &amp;'b str) -&gt; &amp;str
// ä¸èƒ½ç»§ç»­æ¨å¯¼ æŠ¥é”™</code></pre>
<h3 id="é™æ€ç”Ÿå‘½å‘¨æœŸ"><a class="header" href="#é™æ€ç”Ÿå‘½å‘¨æœŸ">é™æ€ç”Ÿå‘½å‘¨æœŸ</a></h3>
<p><code>'static</code> æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸ, è¡¨æ˜åœ¨æ•´ä¸ªç¨‹åºæŒç»­æ—¶é—´å†…éƒ½æ˜¯æœ‰æ•ˆçš„</p>
<p>æ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯ <code>'static</code></p>
<p>ä¸€èˆ¬æ²¡å¿…è¦ä½¿ç”¨ <code>'static</code> ç”Ÿå‘½å‘¨æœŸ</p>
<h2 id="æµ‹è¯•"><a class="header" href="#æµ‹è¯•">æµ‹è¯•</a></h2>
<p>åœ¨å†™ç¨‹åºçš„æ—¶å€™, ä¸ºäº†éªŒè¯ç¨‹åºçš„æ­£ç¡®æ€§, å¾€å¾€éœ€è¦è¿›è¡Œä¸€äº›æµ‹è¯•</p>
<blockquote>
<p>arrange, act, assert</p>
</blockquote>
<p>ç”¨äºæµ‹è¯•çš„å‡½æ•°éœ€è¦ä½¿ç”¨ <code>#[test]</code> è¿™æ ·ä¸€ä¸ª <em>attribute</em> æ¥æ ‡æ³¨</p>
<blockquote>
<p>attribute å°±æ˜¯ä¸€æ®µ Rust ä»£ç çš„å…ƒæ•°æ®</p>
</blockquote>
<p>å¦‚æœå†™äº†ä¸€äº›æµ‹è¯•å‡½æ•°è¦è¿è¡Œæµ‹è¯•, å¯ä»¥ä½¿ç”¨ <code>cargo test</code> å‘½ä»¤æ¥æ‰§è¡Œæµ‹è¯•</p>
<pre><code class="language-rust">#[cfg(test)]
pub mod tests {
    use crate::utils::numeric as N;
    #[test]
    fn do_test() {
        let tol = 1e-6;
        let cbrt = |x: f64| -&gt; f64 { N::newton(&amp;move |y: f64| -&gt; f64 { x - y * y * y }, 1.0) };
        assert!((cbrt(8.0) - 2.0).abs() &lt; tol);
    }
}</code></pre>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„æµ‹è¯•ä¾‹å­</p>
<h3 id="è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯"><a class="header" href="#è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯">è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯</a></h3>
<p><code>assert!()</code> ç­‰å®æ˜¯å¯ä»¥æ·»åŠ è‡ªå®šä¹‰ä¿¡æ¯çš„, åœ¨æµ‹è¯•å¤±è´¥çš„æ—¶å€™æ‰“å°å‡ºæ¥</p>
<pre><code class="language-rust">#[test]
fn another() {
    assert!(2 &gt; 4, "\nhello {}\n", "ok");
}

/// ...

/*
---- tests::tests::another stdout ----
thread 'tests::tests::another' panicked at '
hello ok
', src\tests.rs:13:9
*/</code></pre>
<p>ä¸Šé¢å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯çš„ä¾‹å­, æˆ‘ä»¬æµ‹è¯•å¤±è´¥äº†, è¾“å‡ºäº† <code>hello ok</code></p>
<h3 id="should_panic"><a class="header" href="#should_panic">should_panic</a></h3>
<p>è¿™é‡Œè¦ä»‹ç»ä¸€ä¸ªæ–°çš„ ç‰¹æ€§(attribute), <code>#[should_panic]</code></p>
<pre><code class="language-rust">pub struct Guess {
    val: u32
}

impl Guess {
    pub fn new(val: u32) -&gt; Self {
        if val &lt; 1 || val &gt; 100 {
            panic!("Guess value must between 1 and 100, got '{}'", val);
        }
        Guess { val }
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    #[should_panic]
    fn greater_than_100() {
        Guess::new(200);
    }
}</code></pre>
<p>å³, å¯¹äºä¼šå‘ç”Ÿ ææ…Œ(panic) çš„å‡½æ•°æˆ–ä»£ç ç‰‡æ®µè¿›è¡Œæ ‡æ³¨</p>
<p>å¦‚æœçœŸçš„å‘ç”Ÿäº†ææ…Œ, åˆ™æµ‹è¯•æˆåŠŸ</p>
<p>å¯¹äºæ›´åŠ ç²¾ç¡®çš„æµ‹è¯•, å¯ä»¥ä½¿ç”¨ <code>expected</code> å‚æ•°æ¥æŒ‡æ˜ <code>panic!()</code> çš„æŠ¥é”™åŒ…å«çš„å†…å®¹</p>
<pre><code class="language-rust">/// ...
#[should_panic(expected = "anyway")]
/// ...</code></pre>
<p>å¦‚æœ panic ä¸­ä¸åŒ…å«æŒ‡å®šå†…å®¹, é‚£ä¹ˆå°±ç®—æµ‹è¯•å¤±è´¥</p>
<h3 id="æµ‹è¯•é‡Œçš„-result"><a class="header" href="#æµ‹è¯•é‡Œçš„-result">æµ‹è¯•é‡Œçš„ <code>Result</code></a></h3>
<p>ä¹‹å‰æœ‰è¯´è¿‡, Rust é‡Œçš„ä¸€ç§æ›´åŠ å¸¸ç”¨çš„é”™è¯¯å¤„ç†æ–¹å¼å°±æ˜¯ä½¿ç”¨ <code>Result&lt;T, E&gt;</code></p>
<p>ç›¸è¾ƒäºä½¿ç”¨ <code>assert!()</code> å³ <code>panic!()</code>, è¿˜å¯ç›´æ¥è¿”å› Result ç±»å‹æ¥è¿›è¡Œæµ‹è¯•</p>
<pre><code class="language-rust">#[test]
fn it_works() -&gt; Result&lt;(), String&gt; {
    if 2 + 2 == 4 {
        Ok(())
    } else {
        Err(String::from("2 + 2 != 4"))
    }
}</code></pre>
<h3 id="cargo-test"><a class="header" href="#cargo-test"><code>cargo test</code></a></h3>
<p>å¯¹äº <code>cargo test</code> è¿™ä¸ªå‘½ä»¤, æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å‚æ•°æ¥æ§åˆ¶å…·ä½“æµ‹è¯•è¡Œä¸º</p>
<h4 id="æµ‹è¯•çº¿ç¨‹æ•°"><a class="header" href="#æµ‹è¯•çº¿ç¨‹æ•°">æµ‹è¯•çº¿ç¨‹æ•°</a></h4>
<p>å¦‚æœè¦å¹¶è¡Œæµ‹è¯•, é‚£ä¹ˆéœ€è¦ä¿è¯æµ‹è¯•ä¹‹é—´ä¸ä¼šç›¸äº’ä¾èµ–</p>
<pre><code class="language-bash">cargo test -- --test-threads=12
</code></pre>
<p>å¦‚æœä¸æƒ³å¹¶è¡Œæµ‹è¯•, å¯ä»¥æŒ‡å®šçº¿ç¨‹æ•°ä¸º <code>1</code>, å³å•çº¿ç¨‹æµ‹è¯•å³å¯</p>
<h4 id="æ˜¾ç¤ºè¾“å‡º"><a class="header" href="#æ˜¾ç¤ºè¾“å‡º">æ˜¾ç¤ºè¾“å‡º</a></h4>
<p>é»˜è®¤æƒ…å†µä¸‹, é€šè¿‡çš„æµ‹è¯•ä¸ä¼šè¾“å‡ºç›¸å…³æµ‹è¯•çš„è¾“å‡ºå†…å®¹</p>
<p>å¦‚æœæƒ³è¦è¾“å‡ºæ‰€æœ‰çš„è¾“å‡ºå†…å®¹, å¯ä»¥ä½¿ç”¨ <code>--show-output</code> é€‰é¡¹</p>
<pre><code class="language-bash">cargo test -- --show-output
</code></pre>
<h4 id="æ‰§è¡ŒæŒ‡å®šæµ‹è¯•"><a class="header" href="#æ‰§è¡ŒæŒ‡å®šæµ‹è¯•">æ‰§è¡ŒæŒ‡å®šæµ‹è¯•</a></h4>
<p>æœ‰æ—¶å€™æ‰§è¡Œæ‰€æœ‰çš„æµ‹è¯•æ˜¯æ¯”è¾ƒè´¹æ—¶çš„, è€Œå¤§å¤šæ•°æƒ…å†µæ˜¯ä¸éœ€è¦è¿›è¡Œæ‰€æœ‰æµ‹è¯•çš„, æ‰€ä»¥éœ€è¦æŒ‡å®šæµ‹è¯•åç§°</p>
<pre><code class="language-bash">cargo test &lt;æµ‹è¯•å‡½æ•°å&gt;
</code></pre>
<p>ä½†æ˜¯è¿™æ ·åªèƒ½æµ‹è¯•ä¸€ä¸ªå‡½æ•°, å³åªèƒ½ä¼ é€’ä¸€ä¸ªå‡½æ•°å</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨</p>
<pre><code class="language-bash">cargo test &lt;æµ‹è¯•åç§°&gt;
</code></pre>
<p>æ¥æŒ‡å®šæµ‹è¯•èŒƒå›´, åªè¦æµ‹è¯•å‡½æ•°çš„åç§°ä¸­(åŒ…æ‹¬æ¨¡å—å) å«æœ‰æŒ‡å®šçš„æµ‹è¯•åç§°, é‚£ä¹ˆå°±ä¼šè¢«æ‰§è¡Œ</p>
<h4 id="å¿½ç•¥æµ‹è¯•"><a class="header" href="#å¿½ç•¥æµ‹è¯•">å¿½ç•¥æµ‹è¯•</a></h4>
<p>å¯¹äºä¸€äº›æ¯”è¾ƒéº»çƒ¦çš„æµ‹è¯•, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>#[ignore]</code> è¿™ä¸ªç‰¹æ€§æ¥å¿½ç•¥</p>
<p>å¦‚æœè¦å•ç‹¬æµ‹è¯•è¢«å¿½ç•¥çš„æµ‹è¯•, å¯ä»¥ä½¿ç”¨ <code>--ignored</code> å‚æ•°</p>
<pre><code class="language-bash">cargo test -- --ignored
</code></pre>
<h3 id="æµ‹è¯•ç»„ç»‡"><a class="header" href="#æµ‹è¯•ç»„ç»‡">æµ‹è¯•ç»„ç»‡</a></h3>
<p>ä¸€èˆ¬æµ‹è¯•å¯ä»¥åˆ†ä¸º å•å…ƒæµ‹è¯• å’Œ é›†æˆæµ‹è¯•</p>
<p>å•å…ƒæµ‹è¯• å¯ä»¥æµ‹è¯•æ‰€æœ‰å†…å®¹, è€Œ é›†æˆæµ‹è¯• ä¸€èˆ¬åªèƒ½æµ‹è¯• å…¬å¼€(pub) å†…å®¹</p>
<h4 id="å•å…ƒæµ‹è¯•"><a class="header" href="#å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</a></h4>
<p>å•å…ƒæµ‹è¯•ä¸€èˆ¬ä½¿ç”¨ <code>#[cfg(test)]</code> æ¥æ ‡æ³¨</p>
<ul>
<li>åªæœ‰è¿è¡Œ <code>cargo test</code> æ‰ä¼šç¼–è¯‘å’Œè¿è¡Œ</li>
<li><code>cargo build</code> ä¸ä¼šç¼–è¯‘</li>
</ul>
<h4 id="é›†æˆæµ‹è¯•"><a class="header" href="#é›†æˆæµ‹è¯•">é›†æˆæµ‹è¯•</a></h4>
<p>é›†æˆæµ‹è¯•å®Œå…¨ä½äºè¢«æµ‹è¯•çš„å†…å®¹ä¹‹å¤–</p>
<p>é›†æˆæµ‹è¯•ä¸€èˆ¬ç”¨äºæµ‹è¯•åº“çš„å¤šä¸ªéƒ¨åˆ†æ˜¯å¦èƒ½æ­£å¸¸åœ°å·¥ä½œ</p>
<p>é›†æˆæµ‹è¯•ä¸€èˆ¬ä½äº <code>&lt;projRoot&gt;/tests</code> ç›®å½•ä¸‹, ä¸ <code>src</code> ç›®å½•å¹³çº§</p>
<pre><code class="language-plain">C:.
|   .gitignore
|   Cargo.lock
|   Cargo.toml
|
+---src
|   |   lib.rs
|   |   main.rs
|   |
|   \---utils
|           mod.rs
|           numeric.rs
|
\---tests
        int_tests.rs
</code></pre>
<p>å¦‚æœè¦æµ‹è¯•å•ç‹¬åœ°æŸä¸ªé›†æˆæµ‹è¯•çš„æ–‡ä»¶, å¯ä»¥ä½¿ç”¨</p>
<pre><code class="language-bash">cargo test --test &lt;æ–‡ä»¶å&gt;
</code></pre>
<p>å¯¹äºé›†æˆæµ‹è¯•å­æ¨¡å—, å¦‚ä¸€äº›å¸®åŠ©å‡½æ•°, å¯ä»¥ä½¿ç”¨æ–‡ä»¶å¤¹åˆ†éš”</p>
<p>å³ï¼Œ<code>tests/</code> ä¸‹çš„å­ç›®å½•ä¸ä¼šè¢«è§†ä¸ºå•ç‹¬çš„ crate æ¥ç¼–è¯‘, ä¸ä¼šè¢«æµ‹è¯•</p>
<p>ä½†æ˜¯æ³¨æ„, é›†æˆæµ‹è¯•åªé’ˆå¯¹äº <strong>åº“ç±»å‹</strong> çš„åŒ…, å¯¹äºäºŒè¿›åˆ¶åŒ…, ç”±äºæ— æ³•å¯¹å¤–æš´éœ²å‡½æ•°, æ•…æ— æ³•ä½¿ç”¨é›†æˆæµ‹è¯•, åªèƒ½ä½¿ç”¨ <strong>å•å…ƒæµ‹è¯•</strong></p>
<p>æ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯äºŒè¿›åˆ¶åŒ…å’Œåº“åŒ…æ··åˆçš„å½¢å¼, æ–¹ä¾¿è¿›è¡Œæµ‹è¯•</p>
<hr />
<p>å¥½, ä»Šå¤©å°±å­¦åˆ°è¿™é‡Œç½¢</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>åˆ°ç›®å‰ä¸ºæ­¢, æœªæ¥ä¼šæ·»åŠ æ›´å¤š</p>
</div>
</main>
                        <nav class="nav-wrapper" aria-label="Page navigation">
                            <a rel="prev" href="../../notes/rust/20220523-rust-learn-09.html"
                                class="mobile-nav-chapters previous"
                                title="Previous chapter"
                                aria-label="Previous chapter"
                                aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next prefetch"
                                href="../../notes/rust/20220619-rust-learn-11.html"
                                class="mobile-nav-chapters next"
                                title="Next chapter" aria-label="Next chapter"
                                aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                            <div style="clear: both"></div>
                        </nav>
                    </div>
                </div>
                <div class="giscus-comment">
                </div>
                <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../notes/rust/20220523-rust-learn-09.html"
                        class="nav-chapters previous" title="Previous chapter"
                        aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next prefetch" href="../../notes/rust/20220619-rust-learn-11.html"
                        class="nav-chapters next" title="Next chapter"
                        aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                </nav>
            </div>
            <script>
                window.playground_copyable = true;
            </script>
            <script src="../../elasticlunr.min.js"></script>
            <script src="../../mark.min.js"></script>
            <script src="../../searcher.js"></script>
            <script src="../../clipboard.min.js"></script>
            <script src="../../highlight.js"></script>
            <script src="../../book.js"></script>
            <script src="../../theme/giscus.js"></script>
        </div>
    </body>
</html>
