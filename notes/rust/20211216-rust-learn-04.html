<!DOCTYPE HTML>
<html
    lang="zh-Hans" 
    class="rust" 
    dir="ltr"> 
    <head>
        <title>Rust å­¦ä¹  04 - Kevin Stephen&#x27;s Blogs</title> 
        <meta charset="UTF-8">
        <meta name="description" content="æ‰¾åˆ°å±äºè‡ªå·±çš„å…‰">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        
         
        <link rel="icon" href="../../favicon.svg">
         
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <link rel="stylesheet"
            href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <link rel="stylesheet" href="../../theme/utils.css">

    </head>
    <body class="sidebar-visible no-js">
        <div id="body-container">
            <script>
                // è·å– root è·¯å¾„
                var path_to_root = "../../";
                // è·å–é»˜è®¤ä¸»é¢˜
                var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches
                    ? "ayu"
                    : "rust";
            </script>
            <script>
                try {
                    var theme = localStorage.getItem("mdbook-theme");
                    var sidebar = localStorage.getItem("mdbook-sidebar");

                    if (theme.startsWith('"') && theme.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-theme",
                            theme.slice(1, theme.length - 1).trim()
                        );
                    }

                    if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-sidebar",
                            sidebar.slice(1, sidebar.length - 1).trim()
                        );
                    }
                } catch (e) {}
            </script>
            <script>
                var theme;
                try {
                    theme = localStorage.getItem("mdbook-theme");
                } catch (e) {}
                if (theme === null || theme === undefined) {
                    theme = default_theme;
                }
                var html = document.querySelector("html");
                html.classList.remove("rust");
                html.classList.add(theme);
                var body = document.querySelector("body");
                body.classList.remove("no-js");
                body.classList.add("js");
            </script>

            <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">
            <script>
                var body = document.querySelector("body");
                var sidebar = null;
                var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
                if (document.body.clientWidth >= 1080) {
                try {
                    sidebar = localStorage.getItem("mdbook-sidebar");
                } catch (e) {}
                    sidebar = sidebar || "visible";
                } else {
                    sidebar = "hidden";
                }
                sidebar_toggle.checked = sidebar === "visible";
                body.classList.remove("sidebar-visible");
                body.classList.add("sidebar-" + sidebar);
            </script>

            <nav id="sidebar" class="sidebar" aria-label="Table of contents">
                <div class="sidebar-scrollbox">
                    <ol class="chapter"><li class="chapter-item "><a href="../../init.html">Init</a></li><li class="chapter-item "><a href="../../about.html">About</a></li><li class="chapter-item affix "><li class="part-title">Notes</li><li class="chapter-item expanded "><a href="../../notes/rust/index.html">Rust</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/rust/20210605-rust-learn-01.html">Rust å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/rust/20210610-rust-learn-02.html">Rust å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/rust/20210824-rust-learn-03.html">Rust å­¦ä¹  03</a></li><li class="chapter-item expanded "><a href="../../notes/rust/20211216-rust-learn-04.html" class="active">Rust å­¦ä¹  04</a></li><li class="chapter-item "><a href="../../notes/rust/20220512-rust-learn-05.html">Rust å­¦ä¹  05</a></li><li class="chapter-item "><a href="../../notes/rust/20220514-rust-learn-06.html">Rust å­¦ä¹  06</a></li><li class="chapter-item "><a href="../../notes/rust/20220520-rust-learn-07.html">Rust å­¦ä¹  07</a></li><li class="chapter-item "><a href="../../notes/rust/20220522-rust-learn-08.html">Rust å­¦ä¹  08</a></li><li class="chapter-item "><a href="../../notes/rust/20220523-rust-learn-09.html">Rust å­¦ä¹  09</a></li><li class="chapter-item "><a href="../../notes/rust/20220611-rust-learn-10.html">Rust å­¦ä¹  10</a></li><li class="chapter-item "><a href="../../notes/rust/20220619-rust-learn-11.html">Rust å­¦ä¹  11</a></li><li class="chapter-item "><a href="../../notes/rust/20220619-rust-learn-project-01.html">Rust å­¦ä¹  å®ä¾‹ 01</a></li><li class="chapter-item "><a href="../../notes/rust/20220623-rust-learn-12.html">Rust å­¦ä¹  12</a></li><li class="chapter-item "><a href="../../notes/rust/20220624-rust-learn-13.html">Rust å­¦ä¹  13</a></li><li class="chapter-item "><a href="../../notes/rust/20220925-rust-learn-14.html">Rust å­¦ä¹  14</a></li><li class="chapter-item "><a href="../../notes/rust/20220925-rust-learn-15.html">Rust å­¦ä¹  15</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-final.html">Rust å­¦ä¹  final</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-project-02.html">Rust å­¦ä¹  å®ä¾‹ 02</a></li></ol></li><li class="chapter-item "><a href="../../notes/postgresql/index.html">PostgreSQL</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/postgresql/20230502-psql-learn-01.html">PostgreSQL å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231024-psql-learn-02.html">PostgreSQL å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231110-psql-learn-03.html">PostgreSQL å­¦ä¹  03</a></li></ol></li><li class="chapter-item "><a href="../../notes/typechallenges/index.html">Type Challenges</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/typechallenges/20230425-type-challenges-01.html">TypeScript ç±»å‹ä½“æ“ 01</a></li><li class="chapter-item "><a href="../../notes/typechallenges/20230428-type-challenges-02.html">TypeScript ç±»å‹ä½“æ“ 02</a></li></ol></li><li class="chapter-item "><li class="part-title">Miscellany</li><li class="chapter-item "><a href="../../miscellany/coding/index.html">Coding</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/coding/20210604-scope-of-if-statement.html">if è¯­å¥çš„ä½œç”¨åŸŸ</a></li><li class="chapter-item "><a href="../../miscellany/coding/20221026-parse-math-in-c.html">C è¯­è¨€æ•°å­¦è§£æå™¨</a></li><li class="chapter-item "><a href="../../miscellany/coding/20231107-clash-system-agent.html">Cğœ†ash ç³»ç»Ÿä»£ç†</a></li><li class="chapter-item "><a href="../../miscellany/coding/20240228-use-giscus-in-mdbook.html">åœ¨ mdBook ä¸­ä½¿ç”¨ giscus æœåŠ¡</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/study/index.html">Study</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/study/20221108-qiskit-linear-algebra.html">qiskit çº¿æ€§ä»£æ•°</a></li><li class="chapter-item "><a href="../../miscellany/study/20221111-qiskit-Deutsch-Jozsa-algorithm.html">qiskit Deutsch-Jozsa ç®—æ³•</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/life/index.html">Life</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/life/20230411-about-life.html">è¯´è¯´ä»¥åçš„æ‰“ç®—ç½¢</a></li><li class="chapter-item "><a href="../../miscellany/life/20230715-about-job.html">è°ˆè°ˆæœ€è¿‘çš„å·¥ä½œçŠ¶æ€</a></li><li class="chapter-item "><a href="../../miscellany/life/20230915-end-of-summer.html">æš‘å‡ç»“æŸäº†</a></li><li class="chapter-item "><a href="../../miscellany/life/20231020-new-life.html">æ–°çš„ç”Ÿæ´»</a></li><li class="chapter-item "><a href="../../miscellany/life/20240120-busy-life.html">å¿™å¿™ç¢Œç¢Œ</a></li></ol></li></ol>
                </div>
                <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                    <div class="sidebar-resize-indicator"></div>
                </div>
            </nav>

            <script>
                var sidebarScrollbox = document.querySelector("#sidebar .sidebar-scrollbox");
                sidebarScrollbox.addEventListener(
                    "click",
                    function (e) {
                        if (e.target.tagName === "A") {
                            sessionStorage.setItem("sidebar-scroll", sidebarScrollbox.scrollTop);
                        }
                    },
                    { passive: true }
                );
                var sidebarScrollTop = sessionStorage.getItem("sidebar-scroll");
                sessionStorage.removeItem("sidebar-scroll");
                if (sidebarScrollTop) {
                    // preserve sidebar scroll position when navigating via links within sidebar
                    sidebarScrollbox.scrollTop = sidebarScrollTop;
                } else {
                    // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                    var activeSection = document.querySelector("#sidebar .active");
                    if (activeSection) {
                        activeSection.scrollIntoView({ block: "center" });
                    }
                }
            </script>

            <div id="page-wrapper" class="page-wrapper">
                <div class="page">
                                        <div id="menu-bar-hover-placeholder"></div>
                    <div id="menu-bar" class="menu-bar sticky">
                        <div class="left-buttons">
                            <label id="sidebar-toggle" class="icon-button"
                                for="sidebar-toggle-anchor"
                                title="Toggle Table of Contents"
                                aria-label="Toggle Table of Contents"
                                aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </label>
                            <button id="theme-toggle" class="icon-button"
                                type="button" title="Change theme"
                                aria-label="Change theme" aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup"
                                aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="light">Light</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            <button id="search-toggle" class="icon-button"
                                type="button" title="Search. (Shortkey: s)"
                                aria-label="Toggle Searchbar"
                                aria-expanded="false" aria-keyshortcuts="S"
                                aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                        <h1 class="menu-title">Kevin Stephen&#x27;s Blogs</h1>
                        <div class="right-buttons">
                            <a href="https://github.com/kands-code/kands-code.github.io"
                                title="Git repository"
                                aria-label="Git repository">
                                <i id="git-repository-button"
                                    class="fa fa-github"></i>
                            </a>
                            <a href="https://github.com/kands-code/kands-code.github.io/edit/repo-src/src/src/notes/rust/20211216-rust-learn-04.md"
                                title="Suggest an edit"
                                aria-label="Suggest an edit">
                                <i id="git-edit-button" class="fa fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    <div id="search-wrapper" class="hidden">
                        <form id="searchbar-outer" class="searchbar-outer">
                            <input type="search" id="searchbar" name="searchbar"
                                placeholder="searching..."
                                aria-controls="searchresults-outer"
                                aria-describedby="searchresults-header">
                        </form>
                        <div id="searchresults-outer"
                            class="searchresults-outer hidden">
                            <div id="searchresults-header"
                                class="searchresults-header"></div>
                            <ul id="searchresults">
                            </ul>
                        </div>
                    </div>
                    <script>
                        document
                            .getElementById("sidebar-toggle")
                            .setAttribute("aria-expanded", sidebar === "visible");
                        document
                            .getElementById("sidebar")
                            .setAttribute("aria-hidden", sidebar !== "visible");
                        Array.from(document.querySelectorAll("#sidebar a")).forEach(function (link) {
                            link.setAttribute("tabIndex", sidebar === "visible" ? 0 : -1);
                        });
                    </script>

                    <div id="content" class="content">
                        <main><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="rust-å­¦ä¹ -04"><a class="header" href="#rust-å­¦ä¹ -04">Rust å­¦ä¹  04</a></h1>
<p class="archive-time">archive time: 2021-12-16</p>
<p class="sp-comment">è¿˜æ˜¯å†³å®šçœ‹ä¹¦, å› ä¸ºè¿›åº¦å¯ä»¥è‡ªå·±æŒæ§...</p>
<ul>
<li><a href="#%E5%91%88%E7%8E%B0%E7%BD%91%E9%A1%B5">å‘ˆç°ç½‘é¡µ</a>
<ul>
<li><a href="#cargotoml"><code>Cargo.toml</code></a></li>
<li><a href="#mainrs"><code>main.rs</code></a></li>
<li><a href="#get_index"><code>get_index</code></a></li>
</ul>
</li>
<li><a href="#gcd-%E9%83%A8%E5%88%86">GCD éƒ¨åˆ†</a></li>
<li><a href="#%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA">ç»“æœå±•ç¤º</a></li>
</ul>
<h2 id="å‘ˆç°ç½‘é¡µ"><a class="header" href="#å‘ˆç°ç½‘é¡µ">å‘ˆç°ç½‘é¡µ</a></h2>
<p>ä¹‹å‰åˆšè®²å®Œ <em>å‡½æ•°</em>, ç°åœ¨å°±ç›´æ¥æ¥å†™ä¸€ä¸ªå°æ ·ä¾‹å§</p>
<p>ä½¿ç”¨ <code>cargo</code> æ¥æ–°å»ºé¡¹ç›®</p>
<pre><code class="language-bash">cargo new [--bin] actix-gcd
</code></pre>
<blockquote>
<p>è¿™é‡Œ æ–¹æ‹¬å· <code>[]</code> æ‹¬èµ·æ¥çš„éƒ¨åˆ†æ˜¯å¯é€‰éƒ¨åˆ†, é»˜è®¤åˆ›å»ºçš„å°±æ˜¯åº”ç”¨é¡¹ç›®, æ•…ä¸éœ€è¦ç‰¹åˆ«æŒ‡å®š</p>
</blockquote>
<p>åˆ›å»ºå¥½åçš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„</p>
<pre><code>actix-gcd/
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â””â”€â”€ main.rs
</code></pre>
<p>ç”±äºè¦æ˜¾ç¤ºç½‘é¡µ, æˆ‘ä»¬ä»å¤´å†™èµ·æ˜¯ä¸å¤ªç°å®çš„, å¯ä»¥é€‰æ‹©ä½¿ç”¨åˆ«äººå†™å¥½çš„åº“ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¹‹å‰, æˆ‘ä»¬éœ€è¦åœ¨ <code>Cargo.toml</code> é‡ŒæŒ‡å®šå¥½ï¼Œ
è¿™ä¸ª <code>Cargo.toml</code> å°±æ˜¯ç®¡ç†æˆ‘ä»¬æ•´ä¸ªé¡¹ç›®çš„ <em>é…ç½®æ–‡ä»¶</em>, è€Œæˆ‘ä»¬çš„ä»£ç éƒ½ç»„ç»‡åœ¨ <code>src</code> æ–‡ä»¶å¤¹ä¸‹</p>
<h3 id="cargotoml"><a class="header" href="#cargotoml"><code>Cargo.toml</code></a></h3>
<p>åˆšåˆ›å»ºå¥½çš„ Rust é¡¹ç›®é‡Œ, <code>Cargo.toml</code> çš„å†…å®¹å¤§è‡´å¦‚ä¸‹</p>
<pre><code class="language-toml">[package]
name = "actix-gcd"
version = "0.1.0"
edition = "2021"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
</code></pre>
<p>è€Œæˆ‘ä»¬è¦ä½¿ç”¨åˆ«äººå†™å¥½çš„åº“, ä¹Ÿå°±æ˜¯éœ€è¦<strong>ä¾èµ–</strong>åˆ«äººçš„åº“, æ‰€ä»¥éœ€è¦åœ¨ <code>[dependencies]</code> è¿™ä¸€é¡¹åº•ä¸‹å†™å¥½ä½ éœ€è¦çš„åº“ <em>ä»¥åŠç‰ˆæœ¬</em></p>
<p>è¿™é‡Œ, æˆ‘ä»¬ä¼šç”¨åˆ°å“¦ <code>actix-web</code> å’Œ <code>serde</code> è¿™ä¸¤ä¸ªåº“, å†™å¥½åå†…å®¹å¦‚ä¸‹</p>
<pre><code class="language-toml"># ä¸Šé¢éƒ¨åˆ†ä¸å˜
[dependencies]
actix-web = "3.3.2"
serde = { version = "1.0", features = ["derive"] }
</code></pre>
<p>è‡³äºç‰ˆæœ¬å’Œåº“, å¯ä»¥åœ¨ <a href="https://docs.rs">Docs.rs</a> è¿™ä¸ªç½‘ç«™ä¸ŠæŸ¥è¯¢åˆ°</p>
<p>å†™å¥½ <code>Cargo.toml</code> å, æˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ (<code>actix-gcd/</code>) ä½¿ç”¨</p>
<pre><code class="language-bash">cargo build
</code></pre>
<p>è¿™ä¸ªæŒ‡ä»¤, æ¥é¢„å…ˆä¸‹è½½ä¸€ä¸‹æ‰€éœ€è¦çš„åº“, è¿™æ · <em>cargo</em> å°±ä¼šå» <em>crates.io</em> è¿™ä¸ªç½‘ç«™å»ä¸‹è½½æ‰€éœ€è¦çš„åº“ä»¥åŠåº“æ‰€éœ€è¦çš„ä¾èµ–</p>
<h3 id="mainrs"><a class="header" href="#mainrs"><code>main.rs</code></a></h3>
<p>å¤„ç†å¥½æ‰€éœ€è¦çš„åº“ä¹‹å, æˆ‘ä»¬å¯ä»¥å¼€å§‹å†™æˆ‘ä»¬çš„ä»£ç äº†</p>
<p>å¦‚ä¸Šæ–‡æ‰€è¨€, æˆ‘ä»¬çš„ä»£ç éƒ½ç»„ç»‡åœ¨ <code>src/</code> ç›®å½•ä¸‹, è€Œä¸»è¦çš„æ–‡ä»¶å°±æ˜¯ <code>main.rs</code></p>
<pre><code class="language-rust">use actix_web::{web, App, HttpResponse, HttpServer};

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    let server = HttpServer::new(|| App::new().route("/", web::get().to(get_index)));
    println!("Serving on http://localhost:3000...");
    server.bind("127.0.0.1:3000")?.run().await
}

fn get_index() -&gt; HttpResponse {
    HttpResponse::Ok().content_type("text/html").body(
        r#"
            &lt;title&gt;GCD Calculator&lt;/title&gt;
            &lt;form action="/gcd" method="post"&gt;
            &lt;input type="text" name="n"&gt;
            &lt;input type="text" name="m"&gt;
            &lt;button type="submit"&gt;Compute GCD&lt;/button&gt;
            &lt;/form&gt;
            "#,
    )
}</code></pre>
<p>å¤„ç†å¥½å, æˆ‘ä»¬åœ¨ <code>localhost:3000</code> å°±å¯ä»¥çœ‹è§è¿™ä¸ªé¡µé¢</p>
<p><img src="../../assert/img/rust-learn-04-pic01.png" alt="ç½‘é¡µé¡µé¢å±•ç¤º" /></p>
<p>å¯ä»¥çœ‹è§, æˆ‘ä»¬è¿™ä¸ª <code>main</code> å‡½æ•°æœ‰ç‚¹ä¸ä¸€æ ·</p>
<p>é€šå¸¸çš„ <code>main</code> å‡½æ•°å°±æ˜¯ç›´æ¥ä¸€ä¸ª <code>fn main() { ... }</code>, è€Œè¿™ä¸ªå´æ˜¯ <code>async fn main() -&gt; std::io::Result&lt;()&gt; { ... }</code></p>
<p>è¿™ä¸ªè¿”å›å€¼ç±»å‹ <code>std::io::Result</code> è¿˜æ˜¯å¯ä»¥ç†è§£çš„, å°±æ˜¯ä¸€ä¸ªæšä¸¾ç±», æ²¡é—®é¢˜å°±è¿”å›å€¼æœ¬èº«, æœ‰é”™è¯¯å°±è¿”å›é”™è¯¯,
è€Œè¿™é‡Œçš„ <code>&lt;()&gt;</code> åˆ™æ˜¯æ³›å‹çš„å†™æ³•, è¡¨ç¤ºè¿™ä¸ªè¿”å›å€¼æ˜¯ä¸€ä¸ª io æ“ä½œçš„ <code>Result</code></p>
<p>è€Œä¸”è¿™ä¸ª <code>main</code> å‡½æ•°ä¸Šè¿˜æœ‰ä¸ª <code>#[actix_web::main]</code>, è¿™ä¸ªæ˜¯ä¸€ç§ <em>å® (macro)</em>,
å¯¹åº”çš„æ˜¯ <em>å±æ€§å® (Attribute-like macros)</em>, è¿™ä¸ªå®ä½¿å¾—æˆ‘ä»¬çš„ <code>main</code> å‡½æ•°å¯ä»¥æ˜¯ <code>async</code> çš„</p>
<p><code>main</code> å‡½æ•°é‡Œç¬¬ä¸€å¥ <code>let</code> å£°æ˜äº†ä¸€ä¸ªä¸å¯å˜çš„å˜é‡, ä»–æ˜¯ <code>HttpServer</code> ç±»å‹çš„, å°±ç›¸å½“äºæˆ‘ä»¬ç”¨äºå¤„ç†å“åº”çš„æœåŠ¡å™¨äº†</p>
<p><code>HttpServer::new()</code> ä¸€å¥ä½¿ç”¨ <code>new</code> è¿™ä¸€ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ª <code>HttpServer</code> ç±»å‹çš„å¯¹è±¡(?ä¸çŸ¥è¿™ä¸ªè¯´æ³•å¯¹ä¸å¯¹)ï¼Œ
è¿™é‡Œçš„ <em>new()</em> ç®—æ˜¯çº¦å®š, å¹¶ä¸åƒå…¶ä»–è¯­è¨€çš„ <code>new</code> å…³é”®å­—, æ˜¯è§„å®šå¥½çš„, ä½ å¯ä»¥é€‰æ‹©å…¶ä»–åå­—å¦‚ <code>init()</code> æ¥å®ç°è¿™ä¸ªåŠŸèƒ½</p>
<p><code>new()</code> é‡Œé¢ä¼ é€’äº†ä¸€ä¸ª <em>é—­åŒ… (Closure)</em> ä½œä¸ºå‚æ•°</p>
<p>é—­åŒ…çš„åŸºæœ¬æ ¼å¼æ˜¯</p>
<pre><code class="language-rust">| ... | {
    ...
}</code></pre>
<p><code>||</code> é‡Œè¡¨ç¤ºè¢«æ•è·çš„å˜é‡, åé¢çš„ <code>{}</code> é‡Œè¡¨ç¤ºç›¸å…³æ“ä½œ</p>
<p>è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰æ•è·ä»»ä½•å˜é‡, ç›´æ¥æ‰§è¡Œ <code>{}</code> é‡Œçš„å†…å®¹, å³ä½¿ç”¨ <code>App::new()</code> æ¥ç”Ÿæˆä¸€ä¸ª <code>actix_web::App</code> ç±»å‹çš„å¯¹è±¡ï¼Œ
ä½¿ç”¨ <code>App</code> é‡Œçš„ <code>route</code> å‡½æ•°é…ç½®è·¯ç”±</p>
<p>è¿™ä¸ªå‡½æ•°çš„ç±»å‹æ˜¯</p>
<pre><code class="language-rust">pub fn route(self, path: &amp;str, route: Route) -&gt; Self</code></pre>
<p>å¯è§éœ€è¦æˆ‘ä»¬ä¼ é€’ä¸¤ä¸ªå‚æ•°, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨, å³å¯¹åº”è·¯å¾„, ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ <code>route</code>, å³éœ€è¦é…ç½®çš„è·¯ç”±</p>
<p>è¿™é‡Œæˆ‘ä»¬è¦æŠŠä¸€ä¸ªè·¯ç”±é…ç½®åˆ°ç½‘ç«™æ ¹ç›®å½• (<code>/</code>), è€Œè·¯ç”±æ˜¯ç”± <code>get_index</code> å‡½æ•°é…åˆ <code>web::get().to()</code> å¾—åˆ°</p>
<p>ä¹‹åæ˜¯ä¸€æ®µæç¤ºæ€§è´¨çš„è¾“å‡º, ä¸‹é¢, æˆ‘ä»¬ä½¿ç”¨åˆ›å»ºå¥½çš„è¿™ä¸ª <code>HttpServer</code> ä½¿ç”¨ <code>bind()</code> å‡½æ•°æ¥è¯´æ˜è¦ç»‘å®šçš„ <em>å¥—æ¥å­— (socket)</em> åœ°å€ï¼Œ
åé¢çš„ <code>?</code> è¿™ä¸ªç¬¦å·è¡¨ç¤º <code>Error propagation</code> å³å°† <code>bind</code> è¿”å›å¾—åˆ°çš„é”™è¯¯ä¼ é€’ç»™è°ƒç”¨çš„å‡½æ•°, è€Œä¸æ˜¯åœ¨å½“å‰ä½ç½®å°±å¤„ç†ï¼Œ
ç®—æ˜¯ä¸€ç§å·æ‡’çš„æ–¹å¼, è¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿”å›çš„ <code>Result&lt;()&gt;</code></p>
<p>ç»‘å®šå¥½åœ°å€åå°±å¯ä»¥å¯åŠ¨æœåŠ¡å™¨äº†, <code>run()</code> å‡½æ•°å¯åŠ¨æœåŠ¡å™¨, è¿”å›ä¸€ä¸ª <code>Server</code> ç±»å‹çš„å€¼ï¼Œ
è€Œ <code>.await</code> è¯´æ˜è¿™ä¸ª <code>Server</code> æ˜¯ä»¥ <code>await</code> çš„æ–¹å¼æ‰§è¡Œçš„</p>
<h3 id="get_index"><a class="header" href="#get_index"><code>get_index</code></a></h3>
<p>åœ¨ <code>get_index</code> å‡½æ•°é‡Œ, æˆ‘ä»¬é€šè¿‡ <code>HttpResponse::Ok()</code> æ¥è¿”å›ä¸€ä¸ª <code>HttpResponse</code> å¹¶ä»¥æ­¤æ¥è¿”å›éœ€è¦çš„ <code>route</code>ï¼Œ
è€Œéšåçš„ <code>content_type()</code>ç­‰å†…å®¹å°±æ˜¯çº¯å± <em>HTML</em> çš„å†…å®¹äº†</p>
<h2 id="gcd-éƒ¨åˆ†"><a class="header" href="#gcd-éƒ¨åˆ†">GCD éƒ¨åˆ†</a></h2>
<p>å®Œæˆä¸Šè¿°æ“ä½œåªèƒ½å¤Ÿæ˜¾ç¤ºä¸€ä¸ªç½‘é¡µ, è€Œæˆ‘ä»¬ç‚¹ <em>Compute GCD</em> æŒ‰é’®æ˜¯ä¸ä¼šå¾—åˆ°æ­£ç¡®ååº”çš„, æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­å®Œå–„</p>
<p>åœ¨ <code>src/main.rs</code> æ–‡ä»¶çš„å¤´éƒ¨ä½¿ç”¨ <code>use serde::Deserialize;</code> å¯¼å…¥ <code>serde</code> åº“é‡Œæˆ‘ä»¬éœ€è¦çš„éƒ¨åˆ†</p>
<p>ä¹‹å, æˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬æŒ‰ä¸‹æŒ‰é’®åè¿”å›çš„ç±»å‹, ä»¥ä¾¿æˆ‘ä»¬è§£æ, è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>struct</code></p>
<pre><code class="language-rust">#[derive(Deserialize)]
struct GcdParameters {
    n: u64,
    m: u64,
}</code></pre>
<p>å°† <code>#[derive(Deserialize)]</code> å±æ€§æ”¾åœ¨ç±»å‹å®šä¹‰ä¸Šæ–¹å‘Šè¯‰ <code>serde</code> åœ¨ç¼–è¯‘ç¨‹åºæ—¶æ£€æŸ¥ç±»å‹ï¼Œ
å¹¶è‡ªåŠ¨ç”Ÿæˆä»£ç ä»¥ä» HTML è¡¨å•ç”¨äº POST è¯·æ±‚çš„æ ¼å¼çš„æ•°æ®ä¸­è§£ææ­¤ç±»å‹çš„å€¼,
ä¹Ÿå°±æ˜¯ä¼šè‡ªåŠ¨å°†è¿”å›çš„å€¼è¡¨ç¤ºä¸ºæˆ‘ä»¬å®šä¹‰çš„è¿™ä¸ªç±»å‹çš„å½¢å¼</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ç›¸å…³å“åº”</p>
<pre><code class="language-rust">fn post_gcd(form: web::Form&lt;GcdParameters&gt;) -&gt; HttpResponse {
    if form.n == 0 || form.n == 0 {
        return HttpResponse::BadRequest()
            .content_type("text/html")
            .body("Computing the GCD with zero is boring!");
    }
    let response = format!(
        "The greatest common divisor of the number {} and {} is &lt;b&gt;{}&lt;/b&gt;\n",
        form.n,
        form.m,
        gcd(form.n, form.m)
    );

    HttpResponse::Ok().content_type("text/html").body(response)
}</code></pre>
<p>è¿™é‡Œå°±æ˜¯ä»è¡¨å•ä¸­å¾—åˆ° <code>GcdParameters</code> ç±»å‹, è¿”å›ä¸€ä¸ªå“åº”, å…ˆå¯¹è¾“å…¥è¿›è¡Œæ£€æŸ¥,
å¦‚æœè¾“å…¥å«æœ‰ <code>0</code> åˆ™æ˜¾ç¤º <em>Computing the GCD with zero is boring!</em> è¿™å¥è¯, å¦åˆ™å°±è®¡ç®— <code>gcd</code> å¹¶è¿”å›</p>
<p>è€Œè®¡ç®— <code>gcd</code> çš„æ–¹æ³•å°±æ˜¯å¸¸ç”¨çš„è¾—è½¬ç›¸é™¤æ³•</p>
<pre><code class="language-rust">fn gcd(mut m: u64, mut n: u64) -&gt; u64 {
    assert!(m != 0 &amp;&amp; n != 0);
    while m != 0 {
        if m &lt; n {
            let t = m;
            m = n;
            n = t;
        }
        m = m % n;
    }
    n
}</code></pre>
<p>ä¹‹å, æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹è·¯ç”±çš„é…ç½®, å°†å¯¹ <code>/gcd</code> çš„å“åº”é…ç½®å¥½, å°†åŸæ¥çš„ <code>server</code> å®šä¹‰ä¿®æ”¹ä¸º:</p>
<pre><code class="language-rust">let server = HttpServer::new(|| {
    App::new()
        .route("/", web::get().to(get_index))
        .route("/gcd", web::post().to(post_gcd))
});</code></pre>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†</p>
<h2 id="ç»“æœå±•ç¤º"><a class="header" href="#ç»“æœå±•ç¤º">ç»“æœå±•ç¤º</a></h2>
<p><code>cargo run</code> å, æˆ‘ä»¬è®¿é—® <a href="http://localhost:3000">http://localhost:3000</a>, å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¿™æ ·çš„ç•Œé¢</p>
<p><img src="../../assert/img/rust-learn-04-pic02.png" alt="ç•Œé¢å±•ç¤º" /></p>
<p>åˆ†åˆ«æµ‹è¯•ä¸€ä¸‹, å…ˆæ˜¯æ­£å¸¸è¾“å…¥</p>
<p><img src="../../assert/img/rust-learn-04-pic03.png" alt="æ­£å¸¸è¾“å…¥" /></p>
<p>ç„¶åæ˜¯å«æœ‰ <code>0</code> çš„è¾“å…¥</p>
<p><img src="../../assert/img/rust-learn-04-pic04.png" alt="å«é›¶è¾“å…¥" /></p>
<p>æœ€åæ˜¯å«æœ‰éæ•´æ•°çš„è¾“å…¥</p>
<p><img src="../../assert/img/rust-learn-04-pic05.png" alt="é”™è¯¯è¾“å…¥" /></p>
<p>æƒ³è¦ç»“æŸæˆ‘ä»¬çš„è¿™ä¸ªæœåŠ¡å™¨, ç›´æ¥ä½¿ç”¨ <code>Ctrl+C</code> å³å¯</p>
<hr />
<p>è¿™ä¸ªä¾‹å­æ˜¯æ¯”è¾ƒéš¾ä¸”æ¯”è¾ƒè´´è¿‘å®é™…çš„ä¾‹å­, å€¼å¾—å¥½å¥½çœ‹çœ‹</p>
<p>ä¹¦é‡Œçš„åº“ä½¿ç”¨çš„æ˜¯ <code>1.x</code> çš„ç‰ˆæœ¬, è€Œæˆ‘ä½¿ç”¨çš„æ˜¯ <code>3.3.2</code> ç‰ˆæœ¬, éƒ¨åˆ†å†™æ³•å’Œä¹¦ä¸Šä¸ä¸€è‡´, éœ€è¦æ³¨æ„</p>
</main>
                        <nav class="nav-wrapper" aria-label="Page navigation">
                            <a rel="prev" href="../../notes/rust/20210824-rust-learn-03.html"
                                class="mobile-nav-chapters previous"
                                title="Previous chapter"
                                aria-label="Previous chapter"
                                aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next prefetch"
                                href="../../notes/rust/20220512-rust-learn-05.html"
                                class="mobile-nav-chapters next"
                                title="Next chapter" aria-label="Next chapter"
                                aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                            <div style="clear: both"></div>
                        </nav>
                    </div>
                </div>
                <div class="giscus-comment">
                </div>
                <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../notes/rust/20210824-rust-learn-03.html"
                        class="nav-chapters previous" title="Previous chapter"
                        aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next prefetch" href="../../notes/rust/20220512-rust-learn-05.html"
                        class="nav-chapters next" title="Next chapter"
                        aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                </nav>
            </div>
            <script>
                window.playground_copyable = true;
            </script>
            <script src="../../elasticlunr.min.js"></script>
            <script src="../../mark.min.js"></script>
            <script src="../../searcher.js"></script>
            <script src="../../clipboard.min.js"></script>
            <script src="../../highlight.js"></script>
            <script src="../../book.js"></script>
            <script src="../../theme/giscus.js"></script>
        </div>
    </body>
</html>
