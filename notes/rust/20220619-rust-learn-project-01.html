<!DOCTYPE HTML>
<html
    lang="zh-Hans" 
    class="rust" 
    dir="ltr"> 
    <head>
        <title>Rust å­¦ä¹  å®ä¾‹ 01 - Kevin Stephen&#x27;s Blogs</title> 
        <meta charset="UTF-8">
        <meta name="description" content="æ‰¾åˆ°å±äºè‡ªå·±çš„å…‰">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        
         
        <link rel="icon" href="../../favicon.svg">
         
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <link rel="stylesheet"
            href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <link rel="stylesheet" href="../../theme/utils.css">

    </head>
    <body class="sidebar-visible no-js">
        <div id="body-container">
            <script>
                // è·å– root è·¯å¾„
                var path_to_root = "../../";
                // è·å–é»˜è®¤ä¸»é¢˜
                var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches
                    ? "ayu"
                    : "rust";
            </script>
            <script>
                try {
                    var theme = localStorage.getItem("mdbook-theme");
                    var sidebar = localStorage.getItem("mdbook-sidebar");

                    if (theme.startsWith('"') && theme.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-theme",
                            theme.slice(1, theme.length - 1).trim()
                        );
                    }

                    if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                        localStorage.setItem(
                            "mdbook-sidebar",
                            sidebar.slice(1, sidebar.length - 1).trim()
                        );
                    }
                } catch (e) {}
            </script>
            <script>
                var theme;
                try {
                    theme = localStorage.getItem("mdbook-theme");
                } catch (e) {}
                if (theme === null || theme === undefined) {
                    theme = default_theme;
                }
                var html = document.querySelector("html");
                html.classList.remove("rust");
                html.classList.add(theme);
                var body = document.querySelector("body");
                body.classList.remove("no-js");
                body.classList.add("js");
            </script>

            <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">
            <script>
                var body = document.querySelector("body");
                var sidebar = null;
                var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
                if (document.body.clientWidth >= 1080) {
                try {
                    sidebar = localStorage.getItem("mdbook-sidebar");
                } catch (e) {}
                    sidebar = sidebar || "visible";
                } else {
                    sidebar = "hidden";
                }
                sidebar_toggle.checked = sidebar === "visible";
                body.classList.remove("sidebar-visible");
                body.classList.add("sidebar-" + sidebar);
            </script>

            <nav id="sidebar" class="sidebar" aria-label="Table of contents">
                <div class="sidebar-scrollbox">
                    <ol class="chapter"><li class="chapter-item affix "><a href="../../init.html">Init</a></li><li class="chapter-item affix "><li class="part-title">Notes</li><li class="chapter-item expanded "><a href="../../notes/rust/index.html">Rust</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/rust/20210605-rust-learn-01.html">Rust å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/rust/20210610-rust-learn-02.html">Rust å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/rust/20210824-rust-learn-03.html">Rust å­¦ä¹  03</a></li><li class="chapter-item "><a href="../../notes/rust/20211216-rust-learn-04.html">Rust å­¦ä¹  04</a></li><li class="chapter-item "><a href="../../notes/rust/20220512-rust-learn-05.html">Rust å­¦ä¹  05</a></li><li class="chapter-item "><a href="../../notes/rust/20220514-rust-learn-06.html">Rust å­¦ä¹  06</a></li><li class="chapter-item "><a href="../../notes/rust/20220520-rust-learn-07.html">Rust å­¦ä¹  07</a></li><li class="chapter-item "><a href="../../notes/rust/20220522-rust-learn-08.html">Rust å­¦ä¹  08</a></li><li class="chapter-item "><a href="../../notes/rust/20220523-rust-learn-09.html">Rust å­¦ä¹  09</a></li><li class="chapter-item "><a href="../../notes/rust/20220611-rust-learn-10.html">Rust å­¦ä¹  10</a></li><li class="chapter-item "><a href="../../notes/rust/20220619-rust-learn-11.html">Rust å­¦ä¹  11</a></li><li class="chapter-item expanded "><a href="../../notes/rust/20220619-rust-learn-project-01.html" class="active">Rust å­¦ä¹  å®ä¾‹ 01</a></li><li class="chapter-item "><a href="../../notes/rust/20220623-rust-learn-12.html">Rust å­¦ä¹  12</a></li><li class="chapter-item "><a href="../../notes/rust/20220624-rust-learn-13.html">Rust å­¦ä¹  13</a></li><li class="chapter-item "><a href="../../notes/rust/20220925-rust-learn-14.html">Rust å­¦ä¹  14</a></li><li class="chapter-item "><a href="../../notes/rust/20220925-rust-learn-15.html">Rust å­¦ä¹  15</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-final.html">Rust å­¦ä¹  final</a></li><li class="chapter-item "><a href="../../notes/rust/20221030-rust-learn-project-02.html">Rust å­¦ä¹  å®ä¾‹ 02</a></li></ol></li><li class="chapter-item "><a href="../../notes/postgresql/index.html">PostgreSQL</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/postgresql/20230502-psql-learn-01.html">PostgreSQL å­¦ä¹  01</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231024-psql-learn-02.html">PostgreSQL å­¦ä¹  02</a></li><li class="chapter-item "><a href="../../notes/postgresql/20231110-psql-learn-03.html">PostgreSQL å­¦ä¹  03</a></li></ol></li><li class="chapter-item "><a href="../../notes/typechallenges/index.html">Type Challenges</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../notes/typechallenges/20230425-type-challenges-01.html">TypeScript ç±»å‹ä½“æ“ 01</a></li><li class="chapter-item "><a href="../../notes/typechallenges/20230428-type-challenges-02.html">TypeScript ç±»å‹ä½“æ“ 02</a></li></ol></li><li class="chapter-item "><li class="part-title">Miscellany</li><li class="chapter-item "><a href="../../miscellany/coding/index.html">Coding</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/coding/20210604-scope-of-if-statement.html">if è¯­å¥çš„ä½œç”¨åŸŸ</a></li><li class="chapter-item "><a href="../../miscellany/coding/20221026-parse-math-in-c.html">C è¯­è¨€æ•°å­¦è§£æå™¨</a></li><li class="chapter-item "><a href="../../miscellany/coding/20231107-clash-system-agent.html">Cğœ†ash ç³»ç»Ÿä»£ç†</a></li><li class="chapter-item "><a href="../../miscellany/coding/20240228-use-giscus-in-mdbook.html">åœ¨ mdBook ä¸­ä½¿ç”¨ giscus æœåŠ¡</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/study/index.html">Study</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/study/20221108-qiskit-linear-algebra.html">qiskit çº¿æ€§ä»£æ•°</a></li><li class="chapter-item "><a href="../../miscellany/study/20221111-qiskit-Deutsch-Jozsa-algorithm.html">qiskit Deutsch-Jozsa ç®—æ³•</a></li></ol></li><li class="chapter-item "><a href="../../miscellany/life/index.html">Life</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../miscellany/life/20230411-about-life.html">è¯´è¯´ä»¥åçš„æ‰“ç®—ç½¢</a></li><li class="chapter-item "><a href="../../miscellany/life/20230715-about-job.html">è°ˆè°ˆæœ€è¿‘çš„å·¥ä½œçŠ¶æ€</a></li><li class="chapter-item "><a href="../../miscellany/life/20230915-end-of-summer.html">æš‘å‡ç»“æŸäº†</a></li><li class="chapter-item "><a href="../../miscellany/life/20231020-new-life.html">æ–°çš„ç”Ÿæ´»</a></li><li class="chapter-item "><a href="../../miscellany/life/20240120-busy-life.html">å¿™å¿™ç¢Œç¢Œ</a></li></ol></li><li class="chapter-item "><li class="part-title">About</li></ol>
                </div>
                <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                    <div class="sidebar-resize-indicator"></div>
                </div>
            </nav>

            <script>
                var sidebarScrollbox = document.querySelector("#sidebar .sidebar-scrollbox");
                sidebarScrollbox.addEventListener(
                    "click",
                    function (e) {
                        if (e.target.tagName === "A") {
                            sessionStorage.setItem("sidebar-scroll", sidebarScrollbox.scrollTop);
                        }
                    },
                    { passive: true }
                );
                var sidebarScrollTop = sessionStorage.getItem("sidebar-scroll");
                sessionStorage.removeItem("sidebar-scroll");
                if (sidebarScrollTop) {
                    // preserve sidebar scroll position when navigating via links within sidebar
                    sidebarScrollbox.scrollTop = sidebarScrollTop;
                } else {
                    // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                    var activeSection = document.querySelector("#sidebar .active");
                    if (activeSection) {
                        activeSection.scrollIntoView({ block: "center" });
                    }
                }
            </script>

            <div id="page-wrapper" class="page-wrapper">
                <div class="page">
                                        <div id="menu-bar-hover-placeholder"></div>
                    <div id="menu-bar" class="menu-bar sticky">
                        <div class="left-buttons">
                            <label id="sidebar-toggle" class="icon-button"
                                for="sidebar-toggle-anchor"
                                title="Toggle Table of Contents"
                                aria-label="Toggle Table of Contents"
                                aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </label>
                            <button id="theme-toggle" class="icon-button"
                                type="button" title="Change theme"
                                aria-label="Change theme" aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup"
                                aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="light">Light</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme"
                                        id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem"
                                        class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            <button id="search-toggle" class="icon-button"
                                type="button" title="Search. (Shortkey: s)"
                                aria-label="Toggle Searchbar"
                                aria-expanded="false" aria-keyshortcuts="S"
                                aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                        <h1 class="menu-title">Kevin Stephen&#x27;s Blogs</h1>
                        <div class="right-buttons">
                            <a href="https://github.com/kands-code/kands-code.github.io"
                                title="Git repository"
                                aria-label="Git repository">
                                <i id="git-repository-button"
                                    class="fa fa-github"></i>
                            </a>
                            <a href="https://github.com/kands-code/kands-code.github.io/edit/repo-src/src/src/notes/rust/20220619-rust-learn-project-01.md"
                                title="Suggest an edit"
                                aria-label="Suggest an edit">
                                <i id="git-edit-button" class="fa fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    <div id="search-wrapper" class="hidden">
                        <form id="searchbar-outer" class="searchbar-outer">
                            <input type="search" id="searchbar" name="searchbar"
                                placeholder="searching..."
                                aria-controls="searchresults-outer"
                                aria-describedby="searchresults-header">
                        </form>
                        <div id="searchresults-outer"
                            class="searchresults-outer hidden">
                            <div id="searchresults-header"
                                class="searchresults-header"></div>
                            <ul id="searchresults">
                            </ul>
                        </div>
                    </div>
                    <script>
                        document
                            .getElementById("sidebar-toggle")
                            .setAttribute("aria-expanded", sidebar === "visible");
                        document
                            .getElementById("sidebar")
                            .setAttribute("aria-hidden", sidebar !== "visible");
                        Array.from(document.querySelectorAll("#sidebar a")).forEach(function (link) {
                            link.setAttribute("tabIndex", sidebar === "visible" ? 0 : -1);
                        });
                    </script>

                    <div id="content" class="content">
                        <main><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="rust-å­¦ä¹ -å®ä¾‹-01"><a class="header" href="#rust-å­¦ä¹ -å®ä¾‹-01">Rust å­¦ä¹  å®ä¾‹ 01</a></h1>
<p class="archive-time">archive time: 2022-06-19</p>
<p class="sp-comment">è¿™æ˜¯ä¸€ä¸ªå®æˆ˜çš„ä¾‹å­, å¯ä»¥å¸®åŠ©æŒæ¡ä¹‹å‰çš„å†…å®¹</p>
<ul>
<li><a href="#%E4%BB%8B%E7%BB%8D">ä»‹ç»</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81">ä»£ç </a></li>
<li><a href="#%E8%A7%A3%E9%87%8A">è§£é‡Š</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8-feature">ä½¿ç”¨ feature</a></li>
<li><a href="#%E5%AF%BC%E5%85%A5%E9%9C%80%E8%A6%81%E7%9A%84%E5%BA%93">å¯¼å…¥éœ€è¦çš„åº“</a></li>
<li><a href="#%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B">å®šä¹‰ç±»å‹</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95">å®ç°æ–¹æ³•</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E5%87%BD%E6%95%B0">å®ç°å‡½æ•°</a></li>
<li><a href="#%E5%B0%81%E8%A3%85%E9%80%BB%E8%BE%91">å°è£…é€»è¾‘</a></li>
<li><a href="#%E8%B0%83%E7%94%A8">è°ƒç”¨</a></li>
</ul>
</li>
</ul>
<h2 id="ä»‹ç»"><a class="header" href="#ä»‹ç»">ä»‹ç»</a></h2>
<p>è¿™ä¸ªå®ä¾‹é‡Œé¢, æˆ‘ä»¬è¦å†™ä¸€ä¸ªç±»ä¼¼ <code>grep</code> åŠŸèƒ½çš„å°ç¨‹åº, å³ä»æ–‡æœ¬æˆ–æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”æ–‡æœ¬çš„è¡Œ</p>
<p>ä¸è¿‡æˆ‘ä»¬è¿™ä¸ªä¾‹å­å°±ä¸æ”¯æŒ <em>regex</em> å’Œä¸€äº›é«˜çº§åŠŸèƒ½äº†, ä»…ä»…æ˜¯æŸ¥æ‰¾å¯¹åº”å†…å®¹æ‰€åœ¨çš„è¡Œçš„å†…å®¹</p>
<h2 id="ä»£ç "><a class="header" href="#ä»£ç ">ä»£ç </a></h2>
<p>å®ä¾‹çš„ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-rust">/// lib.rs
#![feature(io_error_more)]

use std::env;
use std::fs;
use std::io::ErrorKind;
use std::path;

#[derive(Debug)]
pub struct Config {
    query: String,
    filename: String,
    conf: Vec&lt;String&gt;,
}

impl Config {
    pub fn new() -&gt; Result&lt;Self, String&gt; {
        let args = env::args().collect::&lt;Vec&lt;_&gt;&gt;();
        if args.len() &lt; 3 {
            Err(format!("no enough arguments\n{}", print_help()))
        } else {
            let conf = args
                .iter()
                .filter(|&amp;s| s.starts_with("-"))
                .map(|s| s.clone())
                .collect::&lt;Vec&lt;_&gt;&gt;();

            let args = args
                .iter()
                .filter(|&amp;s| !(conf.contains(s) || s == &amp;args[0]))
                .take(2)
                .collect::&lt;Vec&lt;_&gt;&gt;();

            Ok(Config {
                query: args[0].clone(),
                filename: args[1].clone(),
                conf,
            })
        }
    }

    pub fn get_file(&amp;self) -&gt; &amp;String {
        &amp;self.filename
    }

    pub fn get_query(&amp;self) -&gt; &amp;String {
        &amp;self.query
    }

    pub fn get_conf(&amp;self) -&gt; &amp;Vec&lt;String&gt; {
        &amp;self.conf
    }
}

pub fn print_help() -&gt; String {
    format!(
        "\n{}\n{}\n{}\n{}\n{}\n",
        "Usage: learn_rs &lt;text&gt; &lt;file&gt; [&lt;args&gt;]",
        "available args:",
        "  `-h` or `--help`: print this message",
        "  `-c` or `--case`: case sensitive (default)",
        "  `-i` or `--insensitive`: case insensitive"
    )
}

pub fn run(config: Config) -&gt; Result&lt;(), ErrorKind&gt; {
    let available_configs = vec!["-h", "--help", "-c", "--case", "-i", "--insensitive"];

    if config
        .get_conf()
        .iter()
        .filter(|&amp;s| !available_configs.contains(&amp;s.as_str()))
        .count()
        &gt; 0
    {
        // check invalid config
        Err(ErrorKind::InvalidInput)
    } else if config.get_conf().contains(&amp;"-h".to_string())
        || config.get_conf().contains(&amp;"-help".to_string())
    {
        // get helps
        Ok(println!("{}", print_help()))
    } else if path::Path::new(config.get_file()).exists() {
        // find pattern
        let contents = fs::read_to_string(config.get_file()).unwrap();

        if config.get_conf().contains(&amp;"-i".to_string())
            || config.get_conf().contains(&amp;"--insensitive".to_string())
        {
            Ok(search_insensitive(config.get_query(), &amp;contents)
                .iter()
                .for_each(|&amp;s| println!("{}", s)))
        } else {
            Ok(search(config.get_query(), &amp;contents)
                .iter()
                .for_each(|&amp;s| println!("{}", s)))
        }
    } else {
        Err(ErrorKind::InvalidFilename)
    }
}

pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    contents
        .lines()
        .filter(|&amp;s| s.contains(query))
        .collect::&lt;Vec&lt;_&gt;&gt;()
}

pub fn search_insensitive&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    contents
        .lines()
        .filter(|&amp;s| s.to_lowercase().contains(&amp;query.to_lowercase()))
        .collect::&lt;Vec&lt;_&gt;&gt;()
}

/// main.rs
use learn_rust::{print_help, run, Config};
use std::process;

fn main() {
    let conf = Config::new().unwrap_or_else(|err| {
        eprintln!("\n&gt;&gt; Initializion Failed: `{}`\n", err);
        process::exit(1);
    });
    if let Err(e) = run(conf) {
        eprintln!("\n&gt;&gt; Runtime Error: `{}`\n", e);
        println!("{}", print_help());
        process::exit(1);
    }
}</code></pre>
<h2 id="è§£é‡Š"><a class="header" href="#è§£é‡Š">è§£é‡Š</a></h2>
<p>æˆ‘ä»¬ä»å¤´å¼€å§‹çœ‹ä»£ç </p>
<h3 id="ä½¿ç”¨-feature"><a class="header" href="#ä½¿ç”¨-feature">ä½¿ç”¨ feature</a></h3>
<p>é¦–å…ˆæ˜¯ <code>&lt;projRoot&gt;/src/lib.rs</code> é‡Œçš„å†…å®¹, ç¬¬ä¸€è¡Œ</p>
<pre><code class="language-rust">#![feature(io_error_more)]</code></pre>
<p>è¿™é‡Œæ˜¯å¯ç”¨ <em>unstable feature</em>, å› ä¸ºæˆ‘ä½¿ç”¨äº† <code>ErrorKind::InvalidFilename</code> è¿™æ ·ä¸€ä¸ªæšä¸¾,
è€Œè¿™ä¸ªæšä¸¾é¡¹è¢«æ ‡è®°ä¸º <code>unstable</code>, æ‰€ä»¥éœ€è¦å¯ç”¨è¿™ä¸ª <em>feature</em> æ‰èƒ½å¯ç”¨</p>
<h3 id="å¯¼å…¥éœ€è¦çš„åº“"><a class="header" href="#å¯¼å…¥éœ€è¦çš„åº“">å¯¼å…¥éœ€è¦çš„åº“</a></h3>
<p>ç„¶åæ˜¯å¯¼å…¥éœ€è¦çš„åº“, éƒ½æ˜¯æ ‡å‡†åº“ä¸‹å°±å­˜åœ¨çš„</p>
<pre><code class="language-rust">use std::env;
use std::fs;
use std::io::ErrorKind;
use std::path;</code></pre>
<p>åˆ†åˆ«æ˜¯ä½¿ç”¨å‚æ•°, è¯»å–æ–‡ä»¶, ä»¥åŠä¸€äº›é”™è¯¯çš„å®šä¹‰ å’Œ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p>
<h3 id="å®šä¹‰ç±»å‹"><a class="header" href="#å®šä¹‰ç±»å‹">å®šä¹‰ç±»å‹</a></h3>
<p>æˆ‘ä»¬ä»å‘½ä»¤è¡Œæ”¶åˆ°çš„å‚æ•°å¯ä»¥ç”¨ä¸€ä¸ªç±»å‹æ¥åŒ…è£¹, æˆ‘ä»¬ç§°å…¶ä¸º <code>Config</code></p>
<pre><code class="language-rust">#[derive(Debug)]
pub struct Config {
    query: String,
    filename: String,
    conf: Vec&lt;String&gt;,
}</code></pre>
<p>å…¶ä¸­ <code>query</code> è¡¨ç¤ºè¦æŸ¥è¯¢çš„å†…å®¹, <code>filename</code> è¡¨ç¤ºè¦ä»å“ªä¸ªæ–‡ä»¶é‡ŒæŸ¥æ‰¾, <code>conf</code> åˆ™æ˜¯ä¸€äº›é€‰é¡¹</p>
<h3 id="å®ç°æ–¹æ³•"><a class="header" href="#å®ç°æ–¹æ³•">å®ç°æ–¹æ³•</a></h3>
<p>å¯¹äºæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹, æˆ‘ä»¬è¿˜éœ€è¦å®ç°ä¸€äº›æ–¹æ³•æ¥ä¾›æˆ‘ä»¬ä½¿ç”¨</p>
<pre><code class="language-rust">impl Config {
    pub fn new() -&gt; Result&lt;Self, String&gt; {
        let args = env::args().collect::&lt;Vec&lt;_&gt;&gt;();
        if args.len() &lt; 3 {
            Err(format!("no enough arguments\n{}", print_help()))
        } else {
            let conf = args
                .iter()
                .filter(|&amp;s| s.starts_with("-"))
                .map(|s| s.clone())
                .collect::&lt;Vec&lt;_&gt;&gt;();

            let args = args
                .iter()
                .filter(|&amp;s| !(conf.contains(s) || s == &amp;args[0]))
                .take(2)
                .collect::&lt;Vec&lt;_&gt;&gt;();

            Ok(Config {
                query: args[0].clone(),
                filename: args[1].clone(),
                conf,
            })
        }
    }

    pub fn get_file(&amp;self) -&gt; &amp;String {
        &amp;self.filename
    }

    pub fn get_query(&amp;self) -&gt; &amp;String {
        &amp;self.query
    }

    pub fn get_conf(&amp;self) -&gt; &amp;Vec&lt;String&gt; {
        &amp;self.conf
    }
}</code></pre>
<p>é¦–å…ˆå°±æ˜¯ <code>new()</code> æ–¹æ³•, è¿™æ˜¯ä¸ªæƒ¯ä¾‹, å®ä¾‹åŒ–ä¸€ä¸ªç±»å‹å¯¹è±¡çš„æ–¹æ³•ä¸€èˆ¬è¢«ç§°ä¸º <code>new()</code>, ä¸è¿‡è¿™ä¸æ˜¯å¿…é¡»çš„</p>
<p>æˆ‘ä»¬çš„ <code>new()</code> æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Result&lt;T, E&gt;</code> ç±»å‹, è¿™æ˜¯å› ä¸ºæœ‰å¯èƒ½ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶æ²¡æœ‰æ­£ç¡®çš„ä¼ å…¥å¯¹åº”å‚æ•°</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›å¤„ç†, å¦‚æœæ²¡æœ‰æ­£ç¡®ä¼ å…¥å‚æ•°å°±è¿”å›ä¸€ä¸ªé”™è¯¯ <code>Err(String)</code></p>
<p>å¦‚æœæœ‰è¶³å¤Ÿçš„å‚æ•°, é‚£ä¹ˆæˆ‘ä»¬è¦å¯¹å‚æ•°è¿›è¡Œç®€å•åˆ†ç±»</p>
<p>å¦‚æœå‚æ•°å‰é¢æœ‰ <code>-</code>, é‚£ä¹ˆè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸ª <code>conf</code></p>
<pre><code class="language-rust">let conf = args
    .iter()
    .filter(|&amp;s| s.starts_with("-"))
    .map(|s| s.clone())
    .collect::&lt;Vec&lt;_&gt;&gt;();</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>iter()</code> æ–¹æ³•å°†å‚æ•°è½¬å˜ä¸ºè¿­ä»£å™¨</p>
<p>ç„¶åä½¿ç”¨ <code>filter()</code> æ–¹æ³•ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å‚æ•°, ä½¿ç”¨ <code>collect()</code> æ–¹æ³•å°†ç­›é€‰å‡ºæ¥çš„çš„å‚æ•°å°è£…æˆä¸€ä¸ª <code>Vec&lt;T&gt;</code> ç±»å‹</p>
<p>é™¤äº†è¿™äº›é€‰é¡¹, å‰©ä½™çš„å°±æ˜¯ç»™ç¨‹åºçš„å‚æ•°</p>
<pre><code class="language-rust">let args = args
    .iter()
    .filter(|&amp;s| !(conf.contains(s) || s == &amp;args[0]))
    .take(2)
    .collect::&lt;Vec&lt;_&gt;&gt;();</code></pre>
<p>ç”±äºæˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªå‚æ•°, å³ éœ€è¦æŸ¥è¯¢çš„å†…å®¹ å’Œ æ–‡ä»¶åœ°å€, æˆ‘ä»¬ä½¿ç”¨ <code>take()</code> æ–¹æ³•æ¥æˆªæ–­</p>
<p>æœ€åå°†ç­›é€‰å‡ºæ¥çš„å†…å®¹åŒ…è£…æˆ <code>Config</code> ç±»å‹</p>
<pre><code class="language-rust">Config {
    query: args[0].clone(),
    filename: args[1].clone(),
    conf,
}</code></pre>
<p>ç”±äºæˆ‘ä»¬ä¸å…è®¸ç›´æ¥ä¿®æ”¹ <code>Config</code> ç±»å‹çš„å­—æ®µ, æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾ç½® <code>getter</code> å¹¶å°†å­—æ®µéšè—,
å³ä¸è®¾ç½®å­—æ®µä¸º <code>pub</code>, è€Œæ˜¯ä½¿ç”¨ <code>get_xxx()</code> è¿™ç§æ–¹æ³•æ¥æˆ–è®¸å­—æ®µå†…å®¹</p>
<h3 id="å®ç°å‡½æ•°"><a class="header" href="#å®ç°å‡½æ•°">å®ç°å‡½æ•°</a></h3>
<p>å¯¹äºç¨‹åºçš„åŠŸèƒ½æˆ‘ä»¬éœ€è¦ä½¿ç”¨å‡½æ•°æ¥å®ç°</p>
<p>æ¯”å¦‚æ‰“å°å¸®åŠ©ä¿¡æ¯</p>
<pre><code class="language-rust">pub fn print_help() -&gt; String {
    format!(
        "\n{}\n{}\n{}\n{}\n{}\n",
        "Usage: learn_rs &lt;text&gt; &lt;file&gt; [&lt;args&gt;]",
        "available args:",
        "  `-h` or `--help`: print this message",
        "  `-c` or `--case`: case sensitive (default)",
        "  `-i` or `--insensitive`: case insensitive"
    )
}</code></pre>
<p>ç„¶åå°±æ˜¯æœç´¢, ä¹Ÿå°±æ˜¯ç¨‹åºçš„ä¸»é€»è¾‘</p>
<pre><code class="language-rust">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    contents
        .lines()
        .filter(|&amp;s| s.contains(query))
        .collect::&lt;Vec&lt;_&gt;&gt;()
}

pub fn search_insensitive&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    contents
        .lines()
        .filter(|&amp;s| s.to_lowercase().contains(&amp;query.to_lowercase()))
        .collect::&lt;Vec&lt;_&gt;&gt;()
}</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬åˆ†æˆäº†ä¸¤ä¸ªå‡½æ•°, ä¹Ÿå°±æ˜¯å¤§å°å†™æ•æ„Ÿå’Œå¤§å°å†™ä¸æ•æ„Ÿ</p>
<p>æˆ‘ä»¬é¦–å…ˆå°†æ–‡ä»¶å†…å®¹è¯»å–ä¸ºå­—ç¬¦ä¸², ç„¶åä½¿ç”¨ <code>lines()</code> å‡½æ•°å°†å­—ç¬¦ä¸²æŒ‰è¡Œåˆ†å‰²æˆä¸€ä¸ªè¿­ä»£å™¨</p>
<p>ç„¶åä½¿ç”¨ <code>filter()</code> æ¥ç­›é€‰, ä½¿ç”¨å­—ç¬¦ä¸²ä¸­çš„ <code>contains()</code> æ–¹æ³•æ¥æŸ¥è¯¢æˆ‘ä»¬è¦æŸ¥è¯¢çš„å†…å®¹æ˜¯å¦åœ¨è¿™ä¸€è¡Œ</p>
<p>ç„¶åæˆ‘ä»¬å°†ç¬¦åˆæ¡ä»¶çš„è¡Œå°è£…åˆ°ä¸€ä¸ª <code>Vec&lt;T&gt;</code> é‡Œè¿”å›</p>
<p>å¯¹äºå¤§å°å†™ä¸æ•æ„Ÿ, æˆ‘ä»¬åªéœ€è¦å°†æŸ¥è¯¢å†…å®¹å’Œæ–‡æœ¬å†…å®¹éƒ½ <code>to_lowercase()</code> å³å¯</p>
<h3 id="å°è£…é€»è¾‘"><a class="header" href="#å°è£…é€»è¾‘">å°è£…é€»è¾‘</a></h3>
<p>æœ€å, æˆ‘ä»¬éœ€è¦å°†è¿™äº›å‡½æ•°çš„é€»è¾‘å°è£…æˆä¸€ä¸ªå•ç‹¬çš„å‡½æ•°</p>
<pre><code class="language-rust">pub fn run(config: Config) -&gt; Result&lt;(), ErrorKind&gt; {
    let available_configs = vec!["-h", "--help", "-c", "--case", "-i", "--insensitive"];

    if config
        .get_conf()
        .iter()
        .filter(|&amp;s| !available_configs.contains(&amp;s.as_str()))
        .count()
        &gt; 0
    {
        // check invalid config
        Err(ErrorKind::InvalidInput)
    } else if config.get_conf().contains(&amp;"-h".to_string())
        || config.get_conf().contains(&amp;"-help".to_string())
    {
        // get helps
        Ok(println!("{}", print_help()))
    } else if path::Path::new(config.get_file()).exists() {
        // find pattern
        let contents = fs::read_to_string(config.get_file()).unwrap();

        if config.get_conf().contains(&amp;"-i".to_string())
            || config.get_conf().contains(&amp;"--insensitive".to_string())
        {
            Ok(search_insensitive(config.get_query(), &amp;contents)
                .iter()
                .for_each(|&amp;s| println!("{}", s)))
        } else {
            Ok(search(config.get_query(), &amp;contents)
                .iter()
                .for_each(|&amp;s| println!("{}", s)))
        }
    } else {
        Err(ErrorKind::InvalidFilename)
    }
}</code></pre>
<p>è¿™é‡Œå°±ä¸ä¸€ä¸€è®²è§£äº†</p>
<h3 id="è°ƒç”¨"><a class="header" href="#è°ƒç”¨">è°ƒç”¨</a></h3>
<p>æˆ‘ä»¬å†™å¥½äº†å‡½æ•°åå°±å¯ä»¥åœ¨ <code>&lt;projRoot&gt;/src/main.rs</code> é‡Œè°ƒç”¨</p>
<pre><code class="language-rust">use learn_rust::{print_help, run, Config};
use std::process;

fn main() {
    let conf = Config::new().unwrap_or_else(|err| {
        eprintln!("\n&gt;&gt; Initializion Failed: `{}`\n", err);
        process::exit(1);
    });
    if let Err(e) = run(conf) {
        eprintln!("\n&gt;&gt; Runtime Error: `{}`\n", e);
        println!("{}", print_help());
        process::exit(1);
    }
}</code></pre>
<p>è¿™é‡Œ, <code>std::process</code> åº“æ˜¯ä¸ºåœ¨å‘ç”Ÿé”™è¯¯æ—¶é€€å‡ºç¨‹åº</p>
<p>ç”±äºæˆ‘ä»¬ä»¥åŠå°è£…å¥½äº†ç¨‹åºé€»è¾‘, æ‰€ä»¥åœ¨è°ƒç”¨æ—¶åªéœ€è¦è°ƒç”¨ <code>run(conf)</code> å³å¯</p>
<hr />
<p>ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ª Rust ç»ƒæ‰‹çš„å°ä¾‹å­, å¸Œæœ›å¤§å®¶èƒ½æœ‰æ‰€æ”¶è·</p>
</main>
                        <nav class="nav-wrapper" aria-label="Page navigation">
                            <a rel="prev" href="../../notes/rust/20220619-rust-learn-11.html"
                                class="mobile-nav-chapters previous"
                                title="Previous chapter"
                                aria-label="Previous chapter"
                                aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next prefetch"
                                href="../../notes/rust/20220623-rust-learn-12.html"
                                class="mobile-nav-chapters next"
                                title="Next chapter" aria-label="Next chapter"
                                aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                            <div style="clear: both"></div>
                        </nav>
                    </div>
                </div>
                <div class="giscus-comment">
                </div>
                <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../notes/rust/20220619-rust-learn-11.html"
                        class="nav-chapters previous" title="Previous chapter"
                        aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next prefetch" href="../../notes/rust/20220623-rust-learn-12.html"
                        class="nav-chapters next" title="Next chapter"
                        aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                </nav>
            </div>
            <script>
                window.playground_copyable = true;
            </script>
            <script src="../../elasticlunr.min.js"></script>
            <script src="../../mark.min.js"></script>
            <script src="../../searcher.js"></script>
            <script src="../../clipboard.min.js"></script>
            <script src="../../highlight.js"></script>
            <script src="../../book.js"></script>
            <script src="../../theme/giscus.js"></script>
        </div>
    </body>
</html>
